"use strict";var t=$("#mapcreatormenu"),a=[$("#general_tabcontent"),$("#description_tabcontent"),$("#team_spawns_tabcontent"),$("#map_limit_tabcontent"),$("#map_points_tabcontent"),$("#bomb_places_tabcontent"),$("#last_tabcontent")],s=[$("#team_spawns_table"),$("#map_limit_table"),void 0,$("#bomb_places_table")],l=$("#team_number_teamspawns"),i=null,o=0,e=null,p,c=!0;function openMapCreatorMenu(t){for(var e=0;e<a.length;++e)a[e].removeClass("active").hide();a[t].addClass("active").show(),null!==i&&(i.removeAttr("bgcolor"),i=null)}function m(){null!==i&&i.removeAttr("bgcolor"),i=null===i||i[0]!==$(this)[0]?$(this).attr("bgcolor","#04074eC7"):null}function addCurrentPosition(t){(0!==t||l.val())&&(o=t,mp.trigger("requestCurrentPositionForMapCreator"))}function gotoPosition(t){if(2===t||null!==i){var e,a,r,n="",s;switch(t){case 0:e=(s=i.find("td")).eq(1).text(),a=s.eq(2).text(),r=s.eq(3).text(),n=s.eq(4).text();break;case 1:case 3:e=(s=i.find("td")).eq(0).text(),a=s.eq(1).text(),r=s.eq(2).text();break;case 2:e=$("#map_center_x").text().substr(3),a=$("#map_center_y").text().substr(3),r=$("#map_center_z").text().substr(3)}mp.trigger("gotoPositionByMapCreator",parseFloat(e),parseFloat(a),parseFloat(r),parseFloat(n))}}function removePosition(){null!==i&&(i.remove(),_())}function loadPositionFromClient(t,e,a,r){var n;switch(o){case 0:(n=$("<tr><td>"+l.val()+"</td><td>"+t+"</td><td>"+e+"</td><td>+"+a+"</td><td>"+r+"</td></tr>")).click(m),s[o].append(n);break;case 1:case 3:(n=$("<tr><td>"+t+"</td><td>"+e+"</td><td>+"+a+"</td></tr>")).click(m),s[o].append(n);break;case 2:$("#map_center_x").text("X: "+t),$("#map_center_y").text("Y: "+e),$("#map_center_z").text("Z: "+a)}_()}function loadLanguage(t){p=JSON.parse(t),$("[data-lang]").each(function(){$(this).html(p[$(this).attr("data-lang")])}),$("[data-lang-placeholder]").each(function(){$(this).attr("placeholder",p[$(this).attr("data-lang-placeholder")])})}function sendMap(){var l={Name:$("#map_name_input").val(),Type:void 0!==$("#normal_radio_switch").attr("checked")?"normal":"bomb",Descriptions:{English:$("#english_description").attr("placeholder"),German:$("#german_description").attr("placeholder")},MinPlayers:parseInt($("#min_players").val()),MaxPlayers:parseInt($("#max_players").val()),MapSpawns:[],MapLimitPositions:[],MapCenter:{},BombPlaces:[]},t=$("#english_description").val();""!==t&&(l.Descriptions.English=t);var e=$("#german_description").val();""!==e&&(l.Descriptions.German=e),$("#team_spawns_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text()),n=parseFloat(t.eq(3).text()),s=parseFloat(t.eq(4).text());l.MapSpawns.push({Team:e,X:a,Y:r,Z:n,Rot:s})}),$("#map_limit_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text());l.MapLimitPositions.push({X:e,Y:a,Z:r})}),l.MapCenter.X=parseFloat($("#map_center_x").text().substr(3)),l.MapCenter.X=isNaN(l.MapCenter.X)?-9999:l.MapCenter.X,l.MapCenter.Y=parseFloat($("#map_center_y").text().substr(3)),l.MapCenter.Y=isNaN(l.MapCenter.Y)?-9999:l.MapCenter.Y,l.MapCenter.Z=parseFloat($("#map_center_z").text().substr(3)),l.MapCenter.Z=isNaN(l.MapCenter.Z)?-9999:l.MapCenter.Z,"bomb"===l.Type&&$("#bomb_places_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text());l.BombPlaces.push({X:e,Y:a,Z:r})}),mp.trigger("sendMapFromCreator",JSON.stringify(l))}function _(){c||($("#send_map_button").attr("disabled",""),c=!0)}function r(){var t;if($("#map_name_input").val().length<6)return showDialog(p.map_name_atleast.replace("{1}","6")),!1;var e=parseInt($("#min_players").val());if(isNaN(e)||e<0||99<e)return showDialog(p.map_min_players_min_max.replace("{1}","0").replace("{2}","99")),!1;var a=parseInt($("#max_players").val()),r;if(isNaN(a)||a<2||999<a)return showDialog(p.map_max_players_min_max.replace("{1}","2").replace("{2}","999")),!1;if($("#team_spawns_table tr:not(:first-child)").length<4)return showDialog(p.map_team_spawns_min_per_team.replace("{1}","4")),!1;var n=$("#map_limit_table tr:not(:first-child)"),s;if(0!==n.length&&(n.length<3||20<n.length))return showDialog(p.map_limit_min_max.replace("{1}","3").replace("{2}",20)),!1;if(void 0!==$("#bomb_radio_switch").attr("checked")&&0===$("#bomb_places_table tr:not(:first-child)").length)return showDialog(p.bomb_places_min.replace("{1}",1)),!1;return c=!1,$("#send_map_button").removeAttr("disabled"),!0}function checkMapName(){mp.trigger("checkMapName",$("#map_name_input").val())}function loadResultOfMapNameCheck(t){t?(alert(p.map_name_already_used),showDialog(p.map_name_already_used)):r()}function toggleBombContents(t){t?$(".bomb_content").show():$(".bomb_content").hide()}setElementDraggable(t[0]),openMapCreatorMenu(0),$(document).keyup(function(t){if(46===t.which){if(null===i)return;i.remove(),i=null}});