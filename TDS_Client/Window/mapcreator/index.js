"use strict";var t=$("#mapcreatormenu"),a=[$("#general_tabcontent"),$("#description_tabcontent"),$("#team_spawns_tabcontent"),$("#map_limit_tabcontent"),$("#map_points_tabcontent"),$("#bomb_places_tabcontent"),$("#last_tabcontent")],l=[$("#team_spawns_table"),$("#map_limit_table"),void 0,$("#bomb_places_table")],s=$("#team_number_teamspawns"),i=null,o=0,e=null,p,c=!0;function openMapCreatorMenu(t){for(var e=0;e<a.length;++e)a[e].removeClass("active").hide();a[t].addClass("active").show(),null!==i&&(i.removeAttr("bgcolor"),i=null)}function _(){null!==i&&i.removeAttr("bgcolor"),i=null===i||i[0]!==$(this)[0]?$(this).attr("bgcolor","#04074eC7"):null}function addCurrentPosition(t){(0!==t||s.val())&&(o=t,mp.trigger("requestCurrentPositionForMapCreator"))}function gotoPosition(t){if(2===t||null!==i){var e,a,r,n="",l;switch(t){case 0:e=(l=i.find("td")).eq(1).text(),a=l.eq(2).text(),r=l.eq(3).text(),n=l.eq(4).text();break;case 1:case 3:e=(l=i.find("td")).eq(0).text(),a=l.eq(1).text(),r=l.eq(2).text();break;case 2:e=$("#map_center_x").text().substr(3),a=$("#map_center_y").text().substr(3),r=$("#map_center_z").text().substr(3)}mp.trigger("gotoPositionByMapCreator",parseFloat(e),parseFloat(a),parseFloat(r),parseFloat(n))}}function removePosition(){null!==i&&(i.remove(),m())}function loadPositionFromClient(t,e,a,r){var n;switch(o){case 0:(n=$("<tr><td>"+s.val()+"</td><td>"+t+"</td><td>"+e+"</td><td>+"+a+"</td><td>"+r+"</td></tr>")).click(_),l[o].append(n);break;case 1:case 3:(n=$("<tr><td>"+t+"</td><td>"+e+"</td><td>+"+a+"</td></tr>")).click(_),l[o].append(n);break;case 2:$("#map_center_x").text("X: "+t),$("#map_center_y").text("Y: "+e),$("#map_center_z").text("Z: "+a)}m()}function loadLanguage(t){p=JSON.parse(t),$("[data-lang]").each(function(){$(this).html(p[$(this).attr("data-lang")])}),$("[data-lang-placeholder]").each(function(){$(this).attr("placeholder",p[$(this).attr("data-lang-placeholder")])})}function sendMap(){var s={Name:$("#map_name_input").val(),Type:void 0!==$("#normal_radio_switch").attr("checked")?"normal":"bomb",Descriptions:{English:$("#english_description").attr("placeholder"),German:$("#german_description").attr("placeholder")},MinPlayers:parseInt($("#min_players").val()),MaxPlayers:parseInt($("#max_players").val()),MapSpawns:[],MapLimitPositions:[],MapCenter:{},BombPlaces:[]},t=$("#english_description").val();""!==t&&(s.Descriptions.English=t);var e=$("#german_description").val();""!==e&&(s.Descriptions.German=e),$("#team_spawns_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text()),n=parseFloat(t.eq(3).text()),l=parseFloat(t.eq(4).text());s.MapSpawns.push({Team:e,X:a,Y:r,Z:n,Rot:l})}),$("#map_limit_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text());s.MapLimitPositions.push({X:e,Y:a,Z:r})}),s.MapCenter.X=parseFloat($("#map_center_x").text().substr(3)),s.MapCenter.X=isNaN(s.MapCenter.X)?-9999:s.MapCenter.X,s.MapCenter.Y=parseFloat($("#map_center_y").text().substr(3)),s.MapCenter.Y=isNaN(s.MapCenter.Y)?-9999:s.MapCenter.Y,s.MapCenter.Z=parseFloat($("#map_center_z").text().substr(3)),s.MapCenter.Z=isNaN(s.MapCenter.Z)?-9999:s.MapCenter.Z,"bomb"===s.Type&&$("#bomb_places_table tr:not(:first-child)").each(function(){var t=$(this).find("td"),e=parseFloat(t.eq(0).text()),a=parseFloat(t.eq(1).text()),r=parseFloat(t.eq(2).text());s.BombPlaces.push({X:e,Y:a,Z:r})}),mp.trigger("sendMapFromCreator",JSON.stringify(s))}function m(){c||($("#send_map_button").attr("disabled",""),c=!0)}function r(){var t;if($("#map_name_input").val().length<6)return showDialog(p.MAP_NAME_ATLEAST_CHARS.replace("{1}","6")),!1;var e=parseInt($("#min_players").val());if(isNaN(e)||e<0||99<e)return showDialog(p.MAP_MIN_PLAYERS_MIN_MAX.replace("{1}","0").replace("{2}","99")),!1;var a=parseInt($("#max_players").val()),r;if(isNaN(a)||a<2||999<a)return showDialog(p.MAP_MAX_PLAYERS_MIN_MAX.replace("{1}","2").replace("{2}","999")),!1;if($("#team_spawns_table tr:not(:first-child)").length<4)return showDialog(p.MAP_TEAM_SPAWNS_MIN_PER_TEAM.replace("{1}","4")),!1;var n=$("#map_limit_table tr:not(:first-child)"),l;if(0!==n.length&&(n.length<3||20<n.length))return showDialog(p.MAP_LIMIT_MIN_MAX.replace("{1}","3").replace("{2}",20)),!1;if(void 0!==$("#bomb_radio_switch").attr("checked")&&0===$("#bomb_places_table tr:not(:first-child)").length)return showDialog(p.BOMB_PLACES_MIN.replace("{1}",1)),!1;return c=!1,$("#send_map_button").removeAttr("disabled"),!0}function checkMapName(){mp.trigger("checkMapName",$("#map_name_input").val())}function loadResultOfMapNameCheck(t){t?(alert(p.MAP_NAME_ALREADY_USED),showDialog(p.MAP_NAME_ALREADY_USED)):r()}function toggleBombContents(t){t?$(".bomb_content").show():$(".bomb_content").hide()}setElementDraggable(t[0]),openMapCreatorMenu(0),$(document).keyup(function(t){if(46===t.which){if(null===i)return;i.remove(),i=null}});