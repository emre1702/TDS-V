"use strict";var n=$("#bloodscreen"),t=$("#kill_messages_box"),i=9,a=$("#orders"),e=$("#audio_hit"),o=[e,e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0),e.clone(!0)],s=0,r=o.length,c;function playSound(e){$("#audio_"+e).trigger("play").volume=.05}function playHitsound(){o[s++].trigger("play").volume=.05,s==r&&(s=0)}function showBloodscreen(){if(c){clearTimeout(c);var e=n.get()[0];e.style.animation="none",e.offsetHeight,e.style.animation="BloodscreenAnim 2.5s"}else n.css({display:"block",animation:"BloodscreenAnim 2.5s"});c=setTimeout(function(){n.css("display","none"),c=null},2500)}function l(e){var n='<span style="color: white;">',t=e;return-1!==e.indexOf("~")&&(t=t.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),n+t+"</span>"}function d(e){e.remove()}function addKillMessage(e){var n=$("<text>"+l(e)+"<br></text>");t.append(n),n.delay(11e3).fadeOut(4e3,n.remove)}function loadOrderNames(e){a.empty();for(var n=JSON.parse(e),t=0;t<n.length&&t<9;++t)a.append($("<div>"+(t+1)+". "+n[t]+"</div>"))}var p=$("#mapmenu"),u=$("#tabs-1"),h=$("#tabs-2"),g=$("#tabs-3"),f=$(B),v=$("#map_info"),m=$("#choose_map_button"),b=$("#add_map_to_favourites"),_=$("#mapvoting"),y,w="",x=!1,C=[],O=[],k="",S=!1,T=!1,D=!1,B="#tabs-4",N=!0;function openMapMenu(e,n){p.show(1e3),x=!0,i=e,k=w="",u.empty(),h.empty(),g.empty(),f.empty(),y=JSON.parse(n);for(var t=0;t<y.length;++t){var a=$("<div>"+y[t].Name+"</div>");0===y[t].Type?u.append(a):h.append(a),-1!==O.indexOf(y[t].Name)&&g.append(a.clone())}for(var o=0;o<C.length;++o)f.append($("<div>"+C[o].name+"</div>"));u.selectable("refresh"),h.selectable("refresh"),g.selectable("refresh"),f.selectable("refresh")}function closeMapMenu(){x=!1,p.hide(500),T&&(m.hide(500),v.hide(500),b.hide(500),T=!1)}function M(e,n){return e.votes>n.votes?-1:1}function A(){C.sort(M)}function J(e){C.push({name:e,votes:1});var n=$("<div>"+C.length+". "+e+" (1)</div>");_.append(n),x&&(f.append($("<div>"+e+"</div>")),f.selectable("refresh")),k===e&&(n.addClass("mapvoting_selected"),k="")}function I(){for(var e=_.children(),n=0;n<e.length;++n)n in C?e.eq(n).text(n+1+". "+mapname+" ("+votes[n].votings+")"):C.splice(n)}function R(e){for(var n=0;n<C.length;++n)if(C[n].name===e)return--C[n].votes<=0&&(C.splice(n,1),_.children().eq(n).remove(),x&&$(B+" div:contains("+e+")")),void I()}function addVoteToMapVoting(e,n){k===e&&$(".mapvoting_selected").removeClass("mapvoting_selected"),void 0!==n&&R(n);for(var t=!1,a=0;a<C.length&&!t;++a)if(C[a].name===e){++C[a].votes;var o=_.children().eq(a);o.text(a+1+". "+e+"("+C[a].votes+")"),k===e&&(o.addClass("mapvoting_selected"),k=""),t=!0}t||J(e),A()}function loadMapVotings(e){var n=JSON.parse(mapsvotesjson);for(var t in C=[],n)C.push({name:t,votes:n[t]});A()}function clearMapVotings(){C=[],_.empty(),x&&(f.empty(),f.selectable("refresh"))}function q(){S=!0,m.disabled=!0,setTimeout(function(){S=!1,m.disabled=!1},1500)}function H(e){-1!==O.indexOf(e)?D||(b.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),D=!0):D&&(b.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),D=!1)}function loadFavouriteMaps(e){O=JSON.parse(e)}function toggleCanVoteForMapWithNumpad(e){(N=e)?(a.hide(300),_.show(300)):(a.show(300),_.hide(300))}$("#tabs").tabs({collapsible:!0,heightStyle:"fill"}),$(".tab_list").each(function(e,n){$(this).selectable({selected:function e(n,t){alert("1"),$(".ui-selected").removeClass("ui-selected"),$(t.selected).addClass("ui-selected");var a=t.selected.innerHTML;H(a);for(var o=0;o<y.length;++o)if(a===y[o].Name)return w=a,T||(m.show(0),v.show(0),b.show(0),T=!0),void v.html(y[o].Description[i]);alert("2")},autoRefresh:!1})}),m.click(function(e){e.preventDefault(),S||""!==w&&(k=w,mp.trigger("MapVote_Browser",k),q())}),b.click(function(e){if(e.preventDefault(),""!==w){var n=O.indexOf(w);-1===n?(O.push(w),b.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),mp.trigger("ToggleMapFavouriteState_Browser",w,!0),g.append($("<div>"+w+"</div>"))):(O.splice(n,1),b.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),mp.trigger("ToggleMapFavouriteState_Browser",w,!1),g.children("div:contains('"+w+"')").remove()),g.selectable("refresh")}}),$("body").keydown(function(e){var n=e.which;if(N&&97<=n&&n<=105){if(S)return;e.preventDefault();var t=9-(105-n)-1;C.length>t&&(k=C[t].name,mp.trigger("MapVote_Browser",k),q())}});var F={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},L=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function V(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(e=null===e?G():e).finish().animate({scrollTop:e.prop("scrollHeight")},"slow")}function j(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";!F.active&&e||e!==F.inputshowing&&(mp.invoke("focus",e),e?(F.maininput.fadeIn(),F.maininput.val(n),setTimeout(function(){F.maininput.focus()},100)):(F.maininput.hide(),F.maininput.val("")),F.inputshowing=e,mp.trigger("ChatInputToggled_Browser",e))}var chatAPI={};function U(e){for(var n=e.indexOf("!{");-1!=n;){var t=e.indexOf("}",n+2);if(-1==t)break;var a=e.substring(n,t+1),o=a.substring(2,a.length-1).split("|"),i=void 0;1==o.length?i=o[0]:o.length<3?i="rgb(".concat(0 in o?o[0]:0,", ").concat(1 in o?o[1]:0,", 0)"):3==o.length?i="rgb(".concat(o[0],", ").concat(o[1],", ").concat(o[2],")"):4==o.length&&(i="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", ").concat(o[3],")"));var s="</span><span style='color: "+i+";'>";n=(e=e.replace(a,s)).indexOf("!{",n+s.length)}return e}function W(e,n){var t="";n&&(t='<span style="background-color: rgba(255,178,102,0.6);">'),t+='<span style="color: white;">';var a=e;if(-1!==e.indexOf("#")){for(var o=0;o<L.length;++o)a=a.replace(L[o][0],"</span><span style='color: "+L[o][1]+";'>");a=a.replace(/#n#/g,"<br>")}return a=U(a),n&&(a+="</span>"),t+a+"</span>"}function Z(e){if(null===F.myname)return!1;var n=e.indexOf("@");if(-1===n)return!1;var t=e.indexOf(":",n+1),a;return-1!==t&&e.substring(n+1,t)===F.myname}function z(e,n,t){n.append(e),++F.amountentries[t]>=F.maxentries&&(--F.amountentries[t],n.find("text:first").remove()),V(n)}function E(e){for(var n=Z(e),t=0;t<F.chatends.length;++t)if(e.endsWith(F.chatends[t])){e=e.slice(0,-F.chatends[t].length);var a=G(t),o=W(e,n),i;return void z($("<text>"+o+"</text>"),a,t)}for(var s=W(e,n),r=0;r<F.bodies.length;++r){var c=G(r),l;z($("<text>"+s+"</text>"),c,r)}}function G(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,n=-1===e?F.chosenchatbody:e;return F.bodies[n]}function loadUserName(e){F.myname=e,F.playernames.push(e)}function loadNamesForChat(e){F.playernames=JSON.parse(e)}function addNameForChat(e){F.playernames.push(e)}function removeNameForChat(e){var n=F.playernames.indexOf(e);-1!=n&&F.playernames.splice(n,1)}chatAPI.push=E,chatAPI.clear=function(){G().html("")},chatAPI.activate=function(e){j(e),F.active=e},chatAPI.show=function(e){e?(G().show(),$("#chat_choice").show()):(G().hide(),$("#chat_choice").hide()),!e&&F.inputshowing&&j(!1),F.active=e},$(document).ready(function(){addAutocomplete(F.maininput,F.playernames,function(){return!(F.autocompleteon=!0)},function(){setTimeout(function(){F.autocompleteon=!1},500)}),$("body").keydown(function(e){if(84===e.which&&!F.inputshowing&&F.active)e.preventDefault(),j(!0);else if(e.which===F.globalsaykeycode&&!F.inputshowing&&F.active)e.preventDefault(),j(!0,"/globalsay ");else if(13===e.which&&F.inputshowing&&!F.autocompleteon){e.preventDefault();var n=F.maininput.val();n&&("/"===(n=n.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?0<(n=n.substr(1)).length&&mp.trigger("CommandUsed_Browser",n):mp.invoke("chatMessage",n+F.chatends[F.chosenchatbody])),j(!1)}}),F.chosentab=$("#chat_choice div[data-chatID=0]"),F.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){F.chosenchatbody!==$(this).attr("data-chatID")&&(F.chosentab.css("background","#A9A9A9"),F.bodies[F.chosenchatbody].hide(400),F.chosentab=$(this),F.chosentab.css("background","#04074e"),F.chosenchatbody=F.chosentab.attr("data-chatID"),F.bodies[F.chosenchatbody].show(400))}),mp.trigger("ChatLoaded_Browser")});var K=$("#round_end_reason"),P=$("#round_end_reason_container"),Q={},X,ee=new SimpleStarRating($("#map_rating_stars")[0],function(e){X in Q&&Q[X]===e||(Q[X]=e,mp.trigger("sendMapRating",X,e),ee.disable())});function showRoundEndReason(e,n){K.html(e),P.css("display","table"),(X=n)in Q?ee.setCurrentRating(Q[n]):ee.setCurrentRating(0),ee.enable()}function hideRoundEndReason(){P.hide()}function loadMyMapRatings(e){Q=JSON.parse(e)}