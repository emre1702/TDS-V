"use strict";var e=$("#bloodscreen"),t=$("#kill_messages_box"),n=9,o=$("#orders"),a,r=$("#audio_hit"),c=[r,r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0),r.clone(!0)],i=0,l=c.length,s=$("#audio_bombTick"),u=[s,s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0),s.clone(!0)],p=0,g=u.length,h,d=.05,m=!1,f=[];function playSound(n){$("#audio_"+n).trigger("play").prop("volume",d)}function playHitsound(){c[i++].trigger("play").prop("volume",d),i==l&&(i=0)}function b(){u[p++].trigger("play").prop("volume",d),p==g&&(p=0)}function playKillstreakSound(n){m?f.push(n):($("#audio_"+soundname).trigger("play").prop("volume",d),m=!0)}function onKillstreakSoundEnded(){var n;(m=!1,0!=f.length)&&playKillstreakSound(f.shift())}function startBombTickSound(n,e){b();var t,o=3e3-2950*(e/n);null!=h&&clearTimeout(h),h=setTimeout(function(){return startBombTickSound(n,e+o)},o)}function stopBombTickSound(){null!=h&&(clearTimeout(h),h=null)}function showBloodscreen(){if(a){clearTimeout(a);var n=e.get()[0];n.style.animation="none",n.offsetHeight,n.style.animation="BloodscreenAnim 2.5s"}else e.css({display:"block",animation:"BloodscreenAnim 2.5s"});a=setTimeout(function(){a=null},2500)}function y(n){var e='<span style="color: white;">',t=n;return-1!==n.indexOf("~")&&(t=t.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),e+t+"</span>"}function v(n){n.remove()}function addKillMessage(n){var e=$("<text>"+y(n)+"<br></text>");t.append(e),e.delay(11e3).fadeOut(4e3,e.remove)}function w(n){n?o.show(1e3):o.hide(1e3)}var _={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},x=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function k(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(n=null===n?A():n).finish().animate({scrollTop:n.prop("scrollHeight")},"slow")}function enableChatInput(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";!_.active&&n||n!==_.inputshowing&&(mp.invoke("focus",n),n?(_.maininput.fadeIn(),_.maininput.val(e),setTimeout(function(){_.maininput.focus()},100)):(_.maininput.hide(),_.maininput.val("")),_.inputshowing=n,mp.trigger("ChatInputToggled_Browser",n))}var chatAPI={};function O(n){for(var e=n.indexOf("!{");-1!=e;){var t=n.indexOf("}",e+2);if(-1==t)break;var o=n.substring(e,t+1),a=o.substring(2,o.length-1).split("|"),r=void 0;1==a.length?r=a[0]:a.length<3?r="rgb(".concat(0 in a?a[0]:0,", ").concat(1 in a?a[1]:0,", 0)"):3==a.length?r="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"):4==a.length&&(r="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", ").concat(a[3],")"));var c="</span><span style='color: "+r+";'>";e=(n=n.replace(o,c)).indexOf("!{",e+c.length)}return n}function C(n,e){var t="";e&&(t='<span style="background-color: rgba(255,178,102,0.6);">'),t+='<span style="color: white;">';var o=n;if(-1!==n.indexOf("#")){for(var a=0;a<x.length;++a)o=o.replace(x[a][0],"</span><span style='color: "+x[a][1]+";'>");o=o.replace(/#n#/g,"<br>")}return o=O(o),e&&(o+="</span>"),t+o+"</span>"}function T(n){if(null===_.myname)return!1;var e=n.indexOf("@");if(-1===e)return!1;var t=n.indexOf(":",e+1),o;return-1!==t&&n.substring(e+1,t)===_.myname}function B(n,e,t){e.append(n),++_.amountentries[t]>=_.maxentries&&(--_.amountentries[t],e.find("text:first").remove()),k(e)}function S(n){for(var e=T(n),t=0;t<_.chatends.length;++t)if(n.endsWith(_.chatends[t])){n=n.slice(0,-_.chatends[t].length);var o=A(t),a=C(n,e),r;return void B($("<text>"+a+"</text>"),o,t)}for(var c=C(n,e),i=0;i<_.bodies.length;++i){var l=A(i),s;B($("<text>"+c+"</text>"),l,i)}}function A(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,e=-1===n?_.chosenchatbody:n;return _.bodies[e]}function loadUserName(n){_.myname=n,_.playernames.push(n)}function loadNamesForChat(n){_.playernames=JSON.parse(n)}function addNameForChat(n){_.playernames.push(n)}function removeNameForChat(n){var e=_.playernames.indexOf(n);-1!=e&&_.playernames.splice(e,1)}function I(n){return void 0===n||null==n||n.replace(/\s/g,"").length<1}chatAPI.push=S,chatAPI.clear=function(){A().html("")},chatAPI.activate=function(n){_.active=n},chatAPI.show=function(n){n?(A().show(),$("#chat_choice").show()):(A().hide(),$("#chat_choice").hide()),_.active=n},$(document).ready(function(){addAutocomplete(_.maininput,_.playernames,function(){return!(_.autocompleteon=!0)},function(){setTimeout(function(){_.autocompleteon=!1},500)}),$("body").keydown(function(n){if(13===n.which&&_.inputshowing&&!_.autocompleteon){n.preventDefault();var e=_.maininput.val();I(e)?mp.trigger("CloseChat_Browser"):"/"===(e=e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?0<(e=e.substr(1)).length&&("test"==e&&S(JSON.stringify(_.playernames)),mp.trigger("CommandUsed_Browser",e)):mp.trigger("ChatUsed_Browser",e,1==_.chosenchatbody)}}),_.chosentab=$("#chat_choice div[data-chatID=0]"),_.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){_.chosenchatbody!==$(this).attr("data-chatID")&&(_.chosentab.css("background","#A9A9A9"),_.bodies[_.chosenchatbody].hide(400),_.chosentab=$(this),_.chosentab.css("background","#04074e"),_.chosenchatbody=_.chosentab.attr("data-chatID"),_.bodies[_.chosenchatbody].show(400))}),mp.trigger("ChatLoaded_Browser")});var D=$("#round_end_reason"),R=$("#round_end_reason_container"),J={},N,H=new SimpleStarRating($("#map_rating_stars")[0],function(n){N in J&&J[N]===n||(J[N]=n,mp.trigger("SendMapRating_Browser",N,n),H.disable())});function showRoundEndReason(n,e){D.html(n),R.css("display","table"),(N=e)in J?H.setCurrentRating(J[e]):H.setCurrentRating(0),H.enable()}function hideRoundEndReason(){R.hide()}function loadMyMapRatings(n){J=JSON.parse(n)}