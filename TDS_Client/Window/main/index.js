"use strict";var n=$("#bloodscreen"),e,t=$("#kill_messages_box"),a=$("#voice_chat_player_names_box"),o=9,r=$("#orders"),c,i=$("#audio_hit"),l=[i,i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0),i.clone(!0)],s=0,u=l.length,p=$("#audio_bombTick"),g=[p,p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0)],h=0,d=g.length,m,f=.05,b=!1,v=[];function playSound(n){$("#audio_"+n).trigger("play").prop("volume",f)}function playHitsound(){l[s++].trigger("play").prop("volume",f),s==u&&(s=0)}function y(){g[h++].trigger("play").prop("volume",f),h==d&&(h=0)}function playKillstreakSound(n){b?v.push(n):($("#audio_"+soundname).trigger("play").prop("volume",f),b=!0)}function onKillstreakSoundEnded(){var n;(b=!1,0!=v.length)&&playKillstreakSound(v.shift())}function startBombTickSound(n,e){y();var t,o=3e3-2950*(e/n);null!=m&&clearTimeout(m),m=setTimeout(function(){return startBombTickSound(n,e+o)},o)}function stopBombTickSound(){null!=m&&(clearTimeout(m),m=null)}function showBloodscreen(){c?(clearTimeout(c),e.style.animation="none",e.offsetHeight,e.style.animation="BloodscreenAnim 2.5s"):n.css({animation:"BloodscreenAnim 2.5s","animation-fill-mode":"forwards"}),c=setTimeout(function(){c=null,n.css({animation:""})},2500)}function _(n){var e='<span style="color: white;">',t=n;return-1!==n.indexOf("~")&&(t=t.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),e+t+"</span>"}function w(n){n.remove()}function addKillMessage(n){var e=$("<text>"+_(n)+"<br></text>");t.append(e),e.delay(11e3).fadeOut(4e3,e.remove)}function x(n){n?r.show(1e3):r.hide(1e3)}function addPlayerTalking(n){var e,t,o=$("<div id='"+("voice-chat-"+n)+"'>"+"<img src='../pic/speaker.png'/>"+"<span>"+n+"</span></div>");a.append(o)}function removePlayerTalking(n){var e="voice-chat-"+n,t=a.find("#"+e);t&&t.remove()}$(document).ready(function(){e=n.get()[0]});var k={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},C=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function O(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(n=null===n?D():n).finish().animate({scrollTop:n.prop("scrollHeight")},"slow")}function enableChatInput(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";!k.active&&n||n!==k.inputshowing&&(mp.invoke("focus",n),n?(k.maininput.fadeIn(),k.maininput.val(e),setTimeout(function(){k.maininput.focus()},100)):(k.maininput.hide(),k.maininput.val("")),k.inputshowing=n,mp.trigger("ChatInputToggled_Browser",n))}var chatAPI={};function T(n){for(var e=n.indexOf("!{");-1!=e;){var t=n.indexOf("}",e+2);if(-1==t)break;var o=n.substring(e,t+1),a=o.substring(2,o.length-1).split("|"),r=void 0;1==a.length?r=a[0]:a.length<3?r="rgb(".concat(0 in a?a[0]:0,", ").concat(1 in a?a[1]:0,", 0)"):3==a.length?r="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"):4==a.length&&(r="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", ").concat(a[3],")"));var c="</span><span style='color: "+r+";'>";e=(n=n.replace(o,c)).indexOf("!{",e+c.length)}return n}function B(n,e){var t="";e&&(t='<span style="background-color: rgba(255,178,102,0.6);">'),t+='<span style="color: white;">';var o=n;if(-1!==n.indexOf("#")){for(var a=0;a<C.length;++a)o=o.replace(C[a][0],"</span><span style='color: "+C[a][1]+";'>");o=o.replace(/#n#/g,"<br>")}return o=T(o),e&&(o+="</span>"),t+o+"</span>"}function S(n){if(null===k.myname)return!1;var e=n.indexOf("@");if(-1===e)return!1;var t=n.indexOf(":",e+1),o;return-1!==t&&n.substring(e+1,t)===k.myname}function A(n,e,t){e.append(n),++k.amountentries[t]>=k.maxentries&&(--k.amountentries[t],e.find("text:first").remove()),O(e)}function I(n){for(var e=S(n),t=0;t<k.chatends.length;++t)if(n.endsWith(k.chatends[t])){n=n.slice(0,-k.chatends[t].length);var o=D(t),a=B(n,e),r;return void A($("<text>"+a+"</text>"),o,t)}for(var c=B(n,e),i=0;i<k.bodies.length;++i){var l=D(i),s;A($("<text>"+c+"</text>"),l,i)}}function D(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,e=-1===n?k.chosenchatbody:n;return k.bodies[e]}function loadUserName(n){k.myname=n,k.playernames.push(n)}function loadNamesForChat(n){k.playernames=JSON.parse(n)}function addNameForChat(n){k.playernames.push(n)}function removeNameForChat(n){var e=k.playernames.indexOf(n);-1!=e&&k.playernames.splice(e,1)}function R(n){return void 0===n||null==n||n.replace(/\s/g,"").length<1}chatAPI.push=I,chatAPI.clear=function(){D().html("")},chatAPI.activate=function(n){k.active=n},chatAPI.show=function(n){n?(D().show(),$("#chat_choice").show()):(D().hide(),$("#chat_choice").hide()),k.active=n},k.maininput.blur(function(){enableChatInput(!1),mp.trigger("CloseChat_Browser")}),$(document).ready(function(){addAutocomplete(k.maininput,k.playernames,function(){return!(k.autocompleteon=!0)},function(){setTimeout(function(){k.autocompleteon=!1},500)}),$("body").keydown(function(n){if(13===n.which&&k.inputshowing&&!k.autocompleteon){n.preventDefault();var e=k.maininput.val();R(e)?mp.trigger("CloseChat_Browser"):"/"===(e=e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?0<(e=e.substr(1)).length&&("test"==e&&I(JSON.stringify(k.playernames)),mp.trigger("CommandUsed_Browser",e)):mp.trigger("ChatUsed_Browser",e,1==k.chosenchatbody)}}),k.chosentab=$("#chat_choice div[data-chatID=0]"),k.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){k.chosenchatbody!==$(this).attr("data-chatID")&&(k.chosentab.css("background","#A9A9A9"),k.bodies[k.chosenchatbody].hide(400),k.chosentab=$(this),k.chosentab.css("background","#04074e"),k.chosenchatbody=k.chosentab.attr("data-chatID"),k.bodies[k.chosenchatbody].show(400))}),mp.trigger("ChatLoaded_Browser")});var J=$("#round_end_reason"),N=$("#round_end_reason_container"),H={},U,q=new SimpleStarRating($("#map_rating_stars")[0],function(n){U in H&&H[U]===n||(H[U]=n,mp.trigger("SendMapRating_Browser",U,n),q.disable())});function showRoundEndReason(n,e){J.html(n),N.css("display","table"),(U=e)in H?q.setCurrentRating(H[e]):q.setCurrentRating(0),q.enable()}function hideRoundEndReason(){N.hide()}function loadMyMapRatings(n){H=JSON.parse(n)}