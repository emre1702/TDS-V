"use strict";function t(n){return a(n)||o(n)||e()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}function a(n){if(Array.isArray(n)){for(var e=0,o=new Array(n.length);e<n.length;e++)o[e]=n[e];return o}}var n=$("#bloodscreen"),r,c=$("#kill_messages_box"),i=$("#voice_chat_player_names_box"),l=9,s=$("#orders"),u,p=$("#audio_hit"),g=[p,p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0),p.clone(!0)],h=0,d=g.length,m=$("#audio_bombTick"),f=[m,m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0),m.clone(!0)],b=0,y=f.length,v,w=.05,_=!1,x=[];function playSound(n){$("#audio_"+n).trigger("play").prop("volume",w)}function playHitsound(){g[h++].trigger("play").prop("volume",w),h==d&&(h=0)}function C(){f[b++].trigger("play").prop("volume",w),b==y&&(b=0)}function playKillstreakSound(n){_?x.push(n):($("#audio_"+soundname).trigger("play").prop("volume",w),_=!0)}function onKillstreakSoundEnded(){var n;(_=!1,0!=x.length)&&playKillstreakSound(x.shift())}function startBombTickSound(n,e){C();var o,t=3e3-2950*(e/n);null!=v&&clearTimeout(v),v=setTimeout(function(){return startBombTickSound(n,e+t)},t)}function stopBombTickSound(){null!=v&&(clearTimeout(v),v=null)}function showBloodscreen(){u?(clearTimeout(u),r.style.animation="none",r.offsetHeight,r.style.animation="BloodscreenAnim 2.5s"):n.css({animation:"BloodscreenAnim 2.5s","animation-fill-mode":"forwards"}),u=setTimeout(function(){u=null,n.css({animation:""})},2500)}function O(n){var e='<span style="color: white;">',o=n;return-1!==n.indexOf("~")&&(o=o.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),e+o+"</span>"}function k(n){n.remove()}function addKillMessage(n){var e=$("<text>"+O(n)+"<br></text>");c.append(e),e.delay(11e3).fadeOut(4e3,e.remove)}function A(n){n?s.show(1e3):s.hide(1e3)}function addPlayerTalking(n){var e,o,t=$("<div id='"+("voice-chat-"+n)+"'>"+"<img src='../pic/speaker.png'/>"+"<span>"+n+"</span></div>");i.append(t)}function removePlayerTalking(n){var e="voice-chat-"+n,o=i.find("#"+e);o&&o.remove()}$(document).ready(function(){r=n.get()[0]});var S={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},T=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function B(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(n=null===n?N():n).finish().animate({scrollTop:n.prop("scrollHeight")},"slow")}function enableChatInput(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";console.log("enableChatInput"),!S.active&&n||(console.log("enableChatInput 2"),n!==S.inputshowing&&(console.log("enableChatInput 3"),n?(console.log("chat input show"),S.maininput.show(400,function(){S.maininput.focus()}),S.maininput.val(e),console.log("chat input show done")):(console.log("chat input hide"),S.maininput.hide(),S.maininput.val(""),console.log("chat input hide done")),S.inputshowing=n))}var chatAPI={};function I(n){for(var e=n.indexOf("!{");-1!=e;){var o=n.indexOf("}",e+2);if(-1==o)break;var t=n.substring(e,o+1),a=t.substring(2,t.length-1).split("|"),r=void 0;1==a.length?r=a[0]:a.length<3?r="rgb(".concat(0 in a?a[0]:0,", ").concat(1 in a?a[1]:0,", 0)"):3==a.length?r="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"):4==a.length&&(r="rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", ").concat(a[3],")"));var c="</span><span style='color: "+r+";'>";e=(n=n.replace(t,c)).indexOf("!{",e+c.length)}return n}function D(n,e){var o="";e&&(o='<span style="background-color: rgba(255,178,102,0.6);">'),o+='<span style="color: white;">';var t=n;if(-1!==n.indexOf("#")){for(var a=0;a<T.length;++a)t=t.replace(T[a][0],"</span><span style='color: "+T[a][1]+";'>");t=t.replace(/#n#/g,"<br>")}return t=I(t),e&&(t+="</span>"),o+t+"</span>"}function R(n){if(null===S.myname)return!1;var e=n.indexOf("@");if(-1===e)return!1;var o=n.indexOf(":",e+1),t;return-1!==o&&n.substring(e+1,o)===S.myname}function j(n,e,o){e.append(n),++S.amountentries[o]>=S.maxentries&&(--S.amountentries[o],e.find("text:first").remove()),B(e)}function J(n){for(var e=R(n),o=0;o<S.chatends.length;++o)if(n.endsWith(S.chatends[o])){n=n.slice(0,-S.chatends[o].length);var t=N(o),a=D(n,e),r;return void j($("<text>"+a+"</text>"),t,o)}for(var c=D(n,e),i=0;i<S.bodies.length;++i){var l=N(i),s;j($("<text>"+c+"</text>"),l,i)}}function N(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,e=-1===n?S.chosenchatbody:n;return S.bodies[e]}function loadUserName(n){S.myname=n,S.playernames.push(n)}function loadNamesForChat(n){var e;S.playernames.length=0;var o=JSON.parse(n);(e=S.playernames).push.apply(e,t(o))}function addNameForChat(n){S.playernames.push(n)}function removeNameForChat(n){var e=S.playernames.indexOf(n);-1!=e&&S.playernames.splice(e,1)}function H(n){return void 0===n||null==n||n.replace(/\s/g,"").length<1}chatAPI.push=J,chatAPI.clear=function(){N().html("")},chatAPI.activate=function(n){S.active=n},chatAPI.show=function(n){n?(N().show(),$("#chat_choice").show()):(N().hide(),$("#chat_choice").hide()),S.active=n},S.maininput.blur(function(){enableChatInput(!1),mp.trigger("CloseChat_Browser")}),$(document).ready(function(){addAutocomplete(S.maininput,S.playernames,function(){return!(S.autocompleteon=!0)},function(){setTimeout(function(){S.autocompleteon=!1},500)}),$("body").keydown(function(n){if(13===n.which&&S.inputshowing&&!S.autocompleteon){n.preventDefault();var e=S.maininput.val();H(e)?mp.trigger("CloseChat_Browser"):"/"===(e=e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?0<(e=e.substr(1)).length&&("test"==e&&J(JSON.stringify(S.playernames)),mp.trigger("CommandUsed_Browser",e)):mp.trigger("ChatUsed_Browser",e,1==S.chosenchatbody)}}),S.chosentab=$("#chat_choice div[data-chatID=0]"),S.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){S.chosenchatbody!==$(this).attr("data-chatID")&&(S.chosentab.css("background","#A9A9A9"),S.bodies[S.chosenchatbody].hide(400),S.chosentab=$(this),S.chosentab.css("background","#04074e"),S.chosenchatbody=S.chosentab.attr("data-chatID"),S.bodies[S.chosenchatbody].show(400))}),mp.trigger("ChatLoaded_Browser")});var U=$("#round_end_reason"),q=$("#round_end_reason_container"),E={},L,M=new SimpleStarRating($("#map_rating_stars")[0],function(n){L in E&&E[L]===n||(E[L]=n,mp.trigger("SendMapRating_Browser",L,n),M.disable())});function showRoundEndReason(n,e){U.html(n),q.css("display","table"),(L=e)in E?M.setCurrentRating(E[e]):M.setCurrentRating(0),M.enable()}function hideRoundEndReason(){q.hide()}function loadMyMapRatings(n){E=JSON.parse(n)}