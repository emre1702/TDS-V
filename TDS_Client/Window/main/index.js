"use strict";var t=$("#money"),e=$("#bloodscreen"),n=$("#audio_hit"),a=$("#kill_messages_box"),i="ENGLISH",o=$("#orders");function setMoney(e){t.text("$"+e)}function playSound(e){$("#audio_"+e).trigger("play").volume=.05}function s(){n.trigger("play").volume=.05}function showBloodscreen(){e.stop().show(0).hide(2500)}function d(e){var t='<span style="color: white;">',n=e;return-1!==e.indexOf("~")&&(n=n.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),t+n+"</span>"}function r(e){e.remove()}function addKillMessage(e){var t=$("<text>"+d(e)+"<br></text>");a.append(t),t.delay(11e3).fadeOut(4e3,t.remove)}function loadOrderNames(e){o.empty();for(var t=JSON.parse(e),n=0;n<t.length&&n<9;++n)o.append($("<div>"+(n+1)+". "+t[n]+"</div>"))}var c=$("#mapmenu"),l=$("#tabs-1"),p=$("#tabs-2"),u=$("#tabs-3"),h=$(D),f=$("#map_info"),v=$("#choose_map_button"),g=$("#add_map_to_favourites"),m=$("#mapvoting"),b,_="",y=!1,w=[],C=[],x="",O=!1,k=!1,S=!1,D="#tabs-4",N=!0;function openMapMenu(e,t){c.show(1e3),y=!0,i=e,x=_="",l.empty(),p.empty(),u.empty(),h.empty(),b=JSON.parse(t);for(var n=0;n<b.length;++n){var a=$("<div>"+b[n].Name+"</div>");0===b[n].Type?l.append(a):p.append(a),-1!==C.indexOf(b[n].Name)&&u.append(a.clone())}for(var o=0;o<w.length;++o)h.append($("<div>"+w[o].name+"</div>"));l.selectable("refresh"),p.selectable("refresh"),u.selectable("refresh"),h.selectable("refresh")}function closeMapMenu(){y=!1,c.hide(500),k&&(v.hide(500),f.hide(500),g.hide(500),k=!1)}function M(e,t){return e.votes>t.votes?-1:1}function T(){w.sort(M)}function I(e){w.push({name:e,votes:1});var t=$("<div>"+w.length+". "+e+" (1)</div>");m.append(t),y&&(h.append($("<div>"+e+"</div>")),h.selectable("refresh")),x===e&&(t.addClass("mapvoting_selected"),x="")}function J(){for(var e=m.children(),t=0;t<e.length;++t)t in w?e.eq(t).text(t+1+". "+mapname+" ("+votes[t].votings+")"):w.splice(t)}function R(e){for(var t=0;t<w.length;++t)if(w[t].name===e)return--w[t].votes<=0&&(w.splice(t,1),m.children().eq(t).remove(),y&&$(D+" div:contains("+e+")")),void J()}function addVoteToMapVoting(e,t){x===e&&$(".mapvoting_selected").removeClass("mapvoting_selected"),void 0!==t&&R(t);for(var n=!1,a=0;a<w.length&&!n;++a)if(w[a].name===e){++w[a].votes;var o=m.children().eq(a);o.text(a+1+". "+e+"("+w[a].votes+")"),x===e&&(o.addClass("mapvoting_selected"),x=""),n=!0}n||I(e),T()}function loadMapVotings(e){var t=JSON.parse(mapsvotesjson);for(var n in w=[],t)w.push({name:n,votes:t[n]});T()}function clearMapVotings(){w=[],m.empty(),y&&(h.empty(),h.selectable("refresh"))}function q(){O=!0,v.disabled=!0,setTimeout(function(){O=!1,v.disabled=!1},1500)}function A(e){-1!==C.indexOf(e)?S||(g.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),S=!0):S&&(g.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),S=!1)}function loadFavouriteMaps(e){C=JSON.parse(e)}function toggleCanVoteForMapWithNumpad(e){(N=e)?(o.hide(300),m.show(300)):(o.show(300),m.hide(300))}$("#tabs").tabs({collapsible:!0,heightStyle:"fill"}),$(".tab_list").each(function(e,t){$(this).selectable({selected:function e(t,n){$(".ui-selected").removeClass("ui-selected"),$(n.selected).addClass("ui-selected");var a=n.selected.innerHTML;A(a);for(var o=0;o<b.length;++o)if(a===b[o].Name)return _=a,k||(v.show(0),f.show(0),g.show(0),k=!0),void f.html(b[o].Description[i])},autoRefresh:!1})}),v.click(function(e){e.preventDefault(),O||""!==_&&(x=_,mp.trigger("onMapMenuVote",x),q())}),g.click(function(e){if(e.preventDefault(),""!==_){var t=C.indexOf(_);-1===t?(C.push(_),g.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),mp.trigger("onClientToggleMapFavourite",_,!0),u.append($("<div>"+_+"</div>"))):(C.splice(t,1),g.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),mp.trigger("onClientToggleMapFavourite",_,!1),u.children("div:contains('"+_+"')").remove()),u.selectable("refresh")}}),$("body").keydown(function(e){var t=e.which;if(N&&97<=t&&t<=105){if(O)return;e.preventDefault();var n=9-(105-t)-1;w.length>n&&(x=w[n].name,mp.trigger("onMapMenuVote",x),q())}});var B={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},H=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function L(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;(e=null===e?G():e).finish().animate({scrollTop:e.prop("scrollHeight")},"slow")}function F(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";!B.active&&e||e!==B.inputshowing&&(mp.invoke("focus",e),e?(B.maininput.fadeIn(),B.maininput.val(t),setTimeout(function(){B.maininput.focus()},100)):(B.maininput.hide(),B.maininput.val("")),B.inputshowing=e,mp.trigger("ChatInputToggled_Browser",e))}var chatAPI={};function d(e,t){var n="";t&&(n='<span style="background-color: rgba(255,178,102,0.6);">'),n+='<span style="color: white;">';var a=e;if(-1!==e.indexOf("#")){for(var o=0;o<H.length;++o)a=a.replace(H[o][0],"</span><span style='color: "+H[o][1]+";'>");a=a.replace(/#n#/g,"<br>")}return t&&(a+="</span>"),n+a+"</span>"}function V(e){if(null===B.myname)return!1;var t=e.indexOf("@");if(-1===t)return!1;var n=e.indexOf(":",t+1),a;return-1!==n&&e.substring(t+1,n)===B.myname}function j(e,t,n){t.append(e),++B.amountentries[n]>=B.maxentries&&(--B.amountentries[n],t.find("text:first").remove()),L(t)}function E(e){for(var t=V(e),n=0;n<B.chatends.length;++n)if(e.endsWith(B.chatends[n])){e=e.slice(0,-B.chatends[n].length);var a=G(n),o=d(e,t),i;return void j($("<text>"+o+"</text>"),a,n)}for(var s=d(e,t),r=0;r<B.bodies.length;++r){var c=G(r),l;j($("<text>"+s+"</text>"),c,r)}}function G(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=-1===e?B.chosenchatbody:e;return B.bodies[t]}function loadUserName(e){B.myname=e,B.playernames.push(e)}function loadNamesForChat(e){B.playernames=JSON.parse(e)}function addNameForChat(e){B.playernames.push(username)}function removeNameForChat(e){var t=B.playernames.indexOf(e);-1!=t&&B.playernames.splice(t,1)}chatAPI.push=E,chatAPI.clear=function(){G().html("")},chatAPI.activate=function(e){F(e),B.active=e},chatAPI.show=function(e){e?(G().show(),$("#chat_choice").show()):(G().hide(),$("#chat_choice").hide()),!e&&B.inputshowing&&F(!1),B.active=e},$(document).ready(function(){addAutocomplete(B.maininput,B.playernames,function(){return!(B.autocompleteon=!0)},function(){setTimeout(function(){B.autocompleteon=!1},500)}),$("body").keydown(function(e){if(84===e.which&&!B.inputshowing&&B.active)e.preventDefault(),F(!0);else if(e.which===B.globalsaykeycode&&!B.inputshowing&&B.active)e.preventDefault(),F(!0,"/globalsay ");else if(13===e.which&&B.inputshowing&&!B.autocompleteon){e.preventDefault();var t=B.maininput.val();t&&("/"===(t=t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?0<(t=t.substr(1)).length&&mp.trigger("CommandUsed_Browser",t):mp.invoke("chatMessage",t+B.chatends[B.chosenchatbody])),F(!1)}}),B.chosentab=$("#chat_choice div[data-chatID=0]"),B.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){B.chosenchatbody!==$(this).attr("data-chatID")&&(B.chosentab.css("background","#A9A9A9"),B.bodies[B.chosenchatbody].hide(400),B.chosentab=$(this),B.chosentab.css("background","#04074e"),B.chosenchatbody=B.chosentab.attr("data-chatID"),B.bodies[B.chosenchatbody].show(400))}),mp.trigger("ChatLoaded_Browser")});var U=$("#round_end_reason"),W=$("#round_end_reason_container"),Z={},z,K=new SimpleStarRating($("#map_rating_stars")[0],function(e){z in Z&&Z[z]===e||(Z[z]=e,mp.trigger("sendMapRating",z,e),K.disable())});function showRoundEndReason(e,t){U.html(e),W.css("display","table"),(z=t)in Z?K.setCurrentRating(Z[t]):K.setCurrentRating(0),K.enable()}function hideRoundEndReason(){W.hide()}function loadMyMapRatings(e){Z=JSON.parse(e)}