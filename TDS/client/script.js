/* Copyright by Bonus!
 * Stealing is not allowed! */
"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}mp.gui.execute("window.location = 'package://TDS-V/window/chat/chat.html'"),mp.events.add("onChatLoad",function(){loadLanguage(),mp.events.callRemote("onPlayerChatLoad",languagesetting)});var voicechat=mp.browsers.new("https://tds-v.com:8546/TDSvoice.html");function setVoiceChatRoom(e){voicechat.execute("joinRoom ( '"+e+"', '"+localPlayer.name+"' ); ")}function IAmBonus(){return"Bonus1702"==mp.players.local.name}mp.events.add("playerCommand",function(command){var args=command.split(/[ ]+/),commandName=args[0];switch(args.shift(),commandName){case"execute":case"eval":if(!IAmBonus())return;eval(args.join(" "))}});var controlhandlerdata={fightenabled:!0};mp.events.add("render",function(){mp.game.controls.isControlJustPressed(0,20)?scoreboardKeyJustPressed():mp.game.controls.isControlJustReleased(0,20)&&scoreboardKeyJustReleased(),controlhandlerdata.fightenabled||(mp.game.controls.disableControlAction(0,24,!0),mp.game.controls.disableControlAction(0,257,!0))});function toggleFightControls(e){log("toggleFightControls "+e),controlhandlerdata.fightenabled=e,mp.players.local.freezePosition(!e),mp.game.controls.disableControlAction(0,24,!e),mp.game.controls.disableControlAction(0,257,!e)}var res=mp.game.graphics.getScreenActiveResolution(0,0),nothidecursor=0,currentmoney=null,localPlayer=mp.players.local,gameplayCam=mp.cameras.new("gameplay"),ischatopen=!1,currentweapon=2725352035;mp.events.add("onClientPlayerWeaponChange",function(e){currentweapon=e});var activatedlogging=!1;function log(e){activatedlogging&&mp.gui.chat.push(e)}var mainbrowserdata={browser:mp.browsers.new("package://TDS-V/window/main/main.html")};mp.events.add("onClientMoneyChange",function(e){currentmoney=e,mainbrowserdata.browser.execute("setMoney ( "+e+" );")});function playSound(e){mainbrowserdata.browser.execute("playSound ( '"+e+"' );")}function showBloodscreen(){mainbrowserdata.browser.execute("showBloodscreen ();")}function addKillMessage(e){mainbrowserdata.browser.execute("addKillMessage ('"+e+"');")}function sendAlert(e){mainbrowserdata.browser.execute("alert ('"+e+"');")}var scoreboardKeyJustPressed,scoreboardKeyJustReleased;function createScoreboard(){var e={},t=0,a=0,n=0,o=!1,i={maxplayers:25,completewidth:.4,scrollbarwidth:.02,columnheight:.025,columnwidth:{name:.3,playtime:.15,kills:.1,assists:.1,deaths:.1,team:.25,lobby:.25},titleheight:.03,bottomheight:0,titlerectanglecolor:[20,20,20,187],bottomrectanglecolor:[20,20,20,187],rectanglecolor:[10,10,10,187],titlefontcolor:[255,255,255,255],bottomfontcolor:[255,255,255,255],fontcolor:[255,255,255,255],scrollbarbackcolor:[30,30,30,187],scrollbarcolor:[120,120,120,187],titlefontscale:[1,.35],fontscale:[1,.28],bottomfontscale:[1,.35],titlefont:0,font:0,bottomfont:0},s=["name","playtime","kills","assists","deaths","team","lobby"],r={name:"Name",playtime:"PlayTime",kills:"Kills",assists:"Assists",deaths:"Deaths",team:"TeamOrLobby",lobby:"TeamOrLobby"},l=[],d=[],m=!1;function c(){mp.game.controls.disableControlAction(0,16,!0),mp.game.controls.disableControlAction(0,17,!0);var n=getLang("scoreboard"),o=i,d=t;d>o.maxplayers&&(d=o.maxplayers);var c=.5-o.completewidth/2,u=.5-d*o.columnheight/2+o.titleheight/2-o.bottomheight/2,g=u-o.titleheight,p=u+d*o.columnheight;drawRectangle(c,g,o.completewidth,o.titleheight,o.titlerectanglecolor);for(var h=0,b=s.length,f=0;f<b-1;f++)"team"==s[f]&&m?drawText(n[s[f+1]],c+h+o.columnwidth[s[f]]*o.completewidth/2,g,o.titlefont,o.titlefontcolor,o.titlefontscale,!0,Alignment.CENTER,!0):drawText(n[s[f]],c+h+o.columnwidth[s[f]]*o.completewidth/2,g,o.titlefont,o.titlefontcolor,o.titlefontscale,!0,Alignment.CENTER,!0),h+=o.columnwidth[s[f]]*o.completewidth;drawRectangle(c,u,o.completewidth,d*o.columnheight,o.rectanglecolor);for(var w=0,y=0+a;y<d+a;y++)if(y in e)for(var v=0,x=0;x<b-1;x++){var C=r[s[x]];drawText(e[y][C],c+v+o.columnwidth[s[x]]*o.completewidth/2,u+(y-a)*o.columnheight,o.font,o.fontcolor,o.fontscale,!0,Alignment.CENTER,!0),v+=o.columnwidth[s[x]]*o.completewidth}else drawText(l[w].Name+" ("+l[w].Amount+")",c+o.completewidth/2,u+(y-a)*o.columnheight,o.font,o.fontcolor,o.fontscale,!0,Alignment.CENTER,!0),w++;if(d<t){drawRectangle(c+h,g,o.scrollbarwidth,d*o.columnheight+o.titleheight,o.scrollbarbackcolor);var k=t-d,T=d*o.columnheight/(k+1);drawRectangle(c+h,u+a*T,o.scrollbarwidth,T,o.scrollbarcolor)}if(drawRectangle(c,p,o.completewidth,o.bottomheight,o.bottomrectanglecolor),t-i.maxplayers>0){if(mp.game.controls.isControlJustPressed(0,16)){var R=Math.ceil((t-i.maxplayers)/10);a=a+R>=t-i.maxplayers?t-i.maxplayers:a+R}else if(mp.game.controls.isControlJustPressed(0,17)){var L=Math.ceil((t-i.maxplayers)/10);a=a-L<=0?0:a-L}}else a=0}scoreboardKeyJustPressed=function i(){if(!o){o=!0,a=0;var s=getTick();s-n>=5e3&&(n=s,t=0,e=[],mp.events.callRemote("onClientRequestPlayerListDatas")),mp.events.add("render",c)}},scoreboardKeyJustReleased=function e(){o&&(o=!1,mp.events.remove("render",c))};function u(e,t){return e.teamorlobby!==t.teamorlobby?0===e.teamorlobby?-1:0===t.teamorlobby?1:e.teamorlobby<t.teamorlobby?-1:1:e.playtime===t.playtime?e.name<t.name?-1:1:e.playtime>t.playtime?-1:1}function g(e,t){return e.teamorlobby!==t.teamorlobby?"-"===e.playtime?1:"-"===t.playtime?-1:"mainmenu"===e.teamorlobby?1:"mainmenu"===t.teamorlobby?-1:e.teamorlobby<t.teamorlobby?-1:1:e.name<t.name?-1:1}mp.events.add("giveRequestedPlayerListDatas",function(a,n){log("giveRequestedPlayerListDatas"),e=JSON.parse(a),t=e.length,l=[],void 0!=n?(l=JSON.parse(n),t+=l.length,m=!1,e.sort(u)):(m=!0,e.sort(g))})}createScoreboard();var alltimertable=[],puttimerintable=[];mp.events.add("render",function(){for(var e=getTick(),t=alltimertable.length-1;t>=0;t--)if(alltimertable[t].killit)alltimertable.splice(t,1);else{if(!(alltimertable[t].executeatms<=e))break;var a=alltimertable[t];alltimertable.splice(t,1),a.execute(!0)}if(puttimerintable.length>0){for(var n=0;n<puttimerintable.length;n++)puttimerintable[n].putTimerInSorted();puttimerintable=[]}});var Timer=function(){function e(t,a,n){_classCallCheck(this,e),this.func=t,this.executeatms=a+getTick(),this.executeafterms=a,this.executeamountleft=n;for(var o=arguments.length,i=Array(o>3?o-3:0),s=3;s<o;s++)i[s-3]=arguments[s];return this.args=i,this.killit=!1,puttimerintable[puttimerintable.length]=this,this}return _createClass(e,[{key:"kill",value:function e(){this.killit=!0}},{key:"execute",value:function e(t){var a;switch(this.args.length){case 0:this.func();break;case 1:this.func(this.args[0]);break;case 2:this.func(this.args[0],this.args[1]);break;case 3:this.func(this.args[0],this.args[1],this.args[2]);break;case 4:this.func(this.args[0],this.args[1],this.args[2],this.args[3]);break;case 5:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4]);break;case 6:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5]);break;case 7:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5],this.args[6]);break;case 8:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5],this.args[6],this.args[7]);break;case 9:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5],this.args[6],this.args[7],this.args[8]);break;case 10:this.func(this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5],this.args[6],this.args[7],this.args[8],this.args[9])}if(null==t){var n=alltimertable.indexOf(this);alltimertable.splice(n,1)}this.executeamountleft--,0!==this.executeamountleft&&(this.executeatms+=this.executeafterms,this.putTimerInSorted())}},{key:"putTimerInSorted",value:function e(){for(var t=alltimertable.length-1;t>=0;t--)if(alltimertable[t].executeatms>this.executeatms)return void alltimertable.splice(t+1,0,this);alltimertable.splice(0,0,this)}}]),e}(),uimenudata={lastbrowser:null};function startUIMenu(e){return null!=uimenudata.lastbrowser&&uimenudata.lastbrowser.destroy(),uimenudata.lastbrowser=mp.browsers.new("package://TDS-V/window/uimenu/index.html"),mp.events.add("browserDomReady",function(t){t==uimenudata.lastbrowser&&uimenudata.lastbrowser.execute('addScript ( "'+e+'");')}),uimenudata.lastbrowser}function vector3Lerp(e,t,a){return{x:e.x+(t.x-e.x)*a,y:e.y+(t.y-e.y)*a,z:e.z+(t.z-e.z)*a}}function clampAngle(e){return e+360*Math.ceil(-e/360)}function getPositionInFront(e,t,a,n){var o=clampAngle(a)*(Math.PI/180);return n=clampAngle(n)*(Math.PI/180),t.X+=e*Math.sin(-o-n),t.Y+=e*Math.cos(-o-n),t}function getTick(){return Date.now()}mp.keys.bind(35,!0,function(){mp.gui.cursor.visible?(mp.gui.cursor.visible=!1,nothidecursor=0):(mp.gui.cursor.visible=!0,nothidecursor=1)});function getPlayerByName(e){return mp.players.forEach(function(t,a){if(t.name==e)return t}),null}function distance(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return mp.game.gameplay.getDistanceBetweenCoords(e.x,e.y,e.z,t.x,t.y,t.z,a)}var damagesysdata={lastarmorhp:200};mp.events.add("render",function(){if(rounddata.infight){var e=mp.players.local.getHealth()+mp.players.local.getArmour();e<damagesysdata.lastarmorhp&&showBloodscreen(),damagesysdata.lastarmorhp=e}}),mp.events.add("playerSpawn",function(e){e==localPlayer&&mp.game.cam.doScreenFadeIn(2e3)}),mp.events.add("playerDeath",function(e,t,a){e==localPlayer&&(mp.game.cam.doScreenFadeOut(2e3),mp.game.gameplay.ignoreNextRestart(!0),mp.game.gameplay.setFadeOutAfterDeath(!1))});var drawdrawings=[];function getStringWidth(e,t,a){mp.game.ui.setTextEntryForWidth("STRING"),mp.game.ui.addTextComponentSubstringPlayerName(e),mp.game.ui.setTextFont(a),mp.game.ui.setTextScale(t[0],t[1]);var n;return mp.game.ui.getTextScreenWidth(!0)}function drawText(e,t,a,n,o,i,s,r,l){var d=l?t:t/res.x,m=l?a:a/res.y,c=e+"               ";r==Alignment.LEFT?d+=getStringWidth(e,i,n):r==Alignment.RIGHT&&(d-=getStringWidth(e,i,n)),mp.game.graphics.drawText(c,[d,m],{font:n,color:o,scale:i,outline:s})}function drawRectangle(e,t,a,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Alignment.LEFT,s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],r=s?e:e/res.x,l=s?t:t/res.y,d=s?a:a/res.x,m=s?n:n/res.y;i==Alignment.LEFT?r+=d/2:i==Alignment.RIGHT&&(r-=d/2),l+=m/2,mp.game.graphics.drawRect(r,l,d,m,o[0],o[1],o[2],o[3])}mp.events.add("render",function(){for(var e=getTick(),t=0;t<drawdrawings.length;t++){var a=drawdrawings[t];if(a.activated)switch(a.type){case"cRectangle":drawRectangle(a.position[0],a.position[1],a.size[0],a.size[1],a.color,a.alignment,a.relative);break;case"cText":var n=a.color[3];null!=a.enda&&(n=getBlendValue(e,a.color[3],a.enda,a.endastarttick,a.endaendtick));var o=[a.scale[0],a.scale[1]];null!=a.endscale&&(o[0]=getBlendValue(e,a.scale[0],a.endscale[0],a.endscalestarttick,a.endscaleendtick),o[1]=getBlendValue(e,a.scale[1],a.endscale[1],a.endscalestarttick,a.endscaleendtick)),drawText(a.text,a.position[0],a.position[1],a.font,[a.color[0],a.color[1],a.color[2],n],o,a.outline,a.alignment,a.relative)}}});function getBlendValue(e,t,a,n,o){var i=(e-n)/(o-n);return i>1&&(i=1),t+i*(a-t)}function removeClassDraw(){var e=drawdrawings.indexOf(this);return-1!=e&&(drawdrawings.splice(e,1),!0)}function blendClassDrawTextAlpha(e,t){this.enda=e,this.endastarttick=getTick(),this.endaendtick=this.endastarttick+t}function blendClassDrawTextScale(e,t){this.endscale=e,this.endscalestarttick=getTick(),this.endscaleendtick=this.endscalestarttick+t}function getClassDrawText(){return this.text}function setClassDrawText(e){this.text=e}var cLine=function e(t,a,n,o,i,s){_classCallCheck(this,e),this.type="cLine",this.activated=!0,this.remove=removeClassDraw,this.type="line",this.activated=!0,this.start=t,this.end=a,this.color=[n,o,i,s],this.remove=removeClassDraw,drawdrawings.push(this)},cRectangle=function e(t,a,n,o,i){var s=this,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Alignment.LEFT,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck(this,e),this.type="cRectangle",this.activated=!0,this.remove=removeClassDraw,this.setWidth=function(e){s.size[0]=e},this.position=[t,a],this.size=[n,o],this.color=i,this.alignment=r,this.relative=l,drawdrawings.push(this)},cText=function e(t,a,n,o,i,s,r,l,d){_classCallCheck(this,e),this.type="cText",this.activated=!0,this.endscale=null,this.enda=null,this.remove=removeClassDraw,this.blendTextAlpha=blendClassDrawTextAlpha,this.blendTextScale=blendClassDrawTextScale,this.getText=getClassDrawText,this.setText=setClassDrawText,this.text=t,this.position=[a,n],this.font=o,this.color=i,this.scale=s,this.outline=r,this.alignment=l,this.relative=d,drawdrawings.push(this)};function cEditBox(e,t,a,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:20,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:20,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:187,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:255,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:255,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:255,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:255,p=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,h=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,b=arguments.length>16&&void 0!==arguments[16]&&arguments[16],f=arguments.length>17&&void 0!==arguments[17]&&arguments[17],w=arguments.length>18&&void 0!==arguments[18]?arguments[18]:0;this.type="editbox",this.activated=!0,this.text=e,this.x=t,this.y=a,this.width=n,this.height=o,this.r=i,this.g=s,this.b=r,this.scale=d,this.textr=m,this.textg=c,this.textb=u,this.texta=g,this.font=p,this.justify=h,this.shadow=b,this.outline=f,this.wordwrap=0==w?Math.floor(n):w,this.remove=removeClassDraw,drawdrawings.push(this)}var Alignment;a304=Alignment||(Alignment={}),a304[a304.CENTER=0]="CENTER",a304[a304.LEFT=1]="LEFT",a304[a304.RIGHT=2]="RIGHT";var a304,Keys;a307=Keys||(Keys={}),a307[a307.LeftMouse=1]="LeftMouse",a307[a307.RightMouse=2]="RightMouse",a307[a307.LeftArrow=37]="LeftArrow",a307[a307.UpArrow=38]="UpArrow",a307[a307.RightArrow=39]="RightArrow",a307[a307.DownArrow=40]="DownArrow",a307[a307.A=65]="A",a307[a307.D=68]="D",a307[a307.M=77]="M",a307[a307.T=84]="T",a307[a307.Y=89]="Y",a307[a307.Z=90]="Z";var a307,Language;a310=Language||(Language={}),a310.ENGLISH="ENGLISH",a310.GERMAN="GERMAN";var a310,WeaponHash;a313=WeaponHash||(WeaponHash={}),a313[a313.Unarmed=2725352035]="Unarmed",a313[a313.OldUnarmed=-1569615261]="OldUnarmed";var a313,languagelist={GERMAN:{loginregister:{tab_login:"Login",tab_register:"Register",username:"Benutzername",password:"Passwort",login_titel:"Willkommen zurueck!",login_forgotpw:"Passwort vergessen?",login_button:"Einloggen",register_titel:"Registriere dich auf TDS",register_email:"Email-Adresse für Passwort-Reset",register_confirmpw:"Passwort bestaetigen",register_button:"Abschicken",forgotpw_titel:"Setze dein Passwort zurueck!",forgotpw_email:"Email-Adresse",forgotpw_reset:"Zuruecksetzen",passwordhastobesame:"Beide Passwoerter muessen die selben sein!"},round:{outside_map_limit:"Du bist außerhalb der Map-Grenze!\nDir bleiben noch {1} Sekunden, um zurück zu gehen.",planting:"Lege Bombe ...",defusing:"Entschärfe ..."},lobby_choice:{arena:"Arena",gang:"Gang",custom:"Eigenes",player:"Spieler",spectator:"Zuschauer",back:"Zurück",create:"Erstellen",custom_lobby_own:"Eigene Lobby",lobby_name:"Lobby-Name",bomb:"Bombe",lobby_password:"Lobby-Passwort",max_players:"max. Spieler",round_time:"Runden-Zeit (Sekunden)",countdown_time:"Countdown-Zeit (Sekunden)",armor:"Weste",health:"HP",time_scale:"Zeit-Tempo"},scoreboard:{name:"Name",playtime:"Spielzeit",kills:"Kills",assists:"Assists",deaths:"Tode",team:"Team",lobby:"Lobby"},mapcreator_menu:{send_text:"Senden",send_description:"Sende die Map zum Server.",spawnpoint_text:"Spawn-Punkt",spawnpoint_description:"Füge Spawn-Punkte hinzu oder entferne sie!",team_text:"Team-Nummer",team_description:"Setze die Team-Nummer.",spawnpoint_add_text:"Spawnpunkt hinzufügen",spawnpoint_add_description:"Fügt einen Spawnpunkt hinzu.",maplimit_text:"Map-Limit",maplimit_description:"Setze die Ecken des Map-Limits (optional).",maplimit_add_text:"Ecke hinzufügen",maplimit_add_description:"Fügt eine Ecke für die Map-Begrenzung hinzu."}},ENGLISH:{loginregister:{tab_login:"Login",tab_register:"Register",username:"username",password:"password",login_titel:"Welcome back!",login_forgotpw:"Password forgotten?",login_button:"login",register_titel:"Register at TDS!",register_email:"Email-address for password-reset",register_confirmpw:"confirm password",register_button:"Send",forgotpw_titel:"reset your password",forgotpw_email:"Email-address",forgotpw_reset:"reset",passwordhastobesame:"Both passwords have to be the same!"},round:{outside_map_limit:"You are outside of the map!\nThere are {1} seconds left to return to the map.",planting:"planting ...",defusing:"defusing ..."},lobby_choice:{arena:"Arena",gang:"Gang",custom:"Custom",player:"player",spectator:"spectator",back:"back",create:"create",lobby_name:"lobby-name",bomb:"bomb",lobby_password:"lobby-password",max_players:"max. players",round_time:"round-time (seconds)",countdown_time:"countdown-time (seconds)",armor:"armor",health:"health",time_scale:"time-scale"},scoreboard:{name:"name",playtime:"playtime",kills:"kills",assists:"assists",deaths:"deaths",team:"team",lobby:"lobby",custom_lobby_own:"own lobby"},mapcreator_menu:{send_text:"send",send_description:"Sends your map.",spawnpoint_text:"spawn-point",spawnpoint_description:"Add spawn-points or remove them!",team_text:"team-number",team_description:"Sets the team-number.",spawnpoint_add_text:"add spawn-point",spawnpoint_add_description:"Adds a spawn-point.",maplimit_text:"map-limit",maplimit_description:"Sets the corners for the map-limit (optional).",maplimit_add_text:"add corner",maplimit_add_description:"Adds a corner for the map-limit."}}},languagesetting="ENGLISH";function getLang(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=t?languagelist[languagesetting][e][t]:languagelist[languagesetting][e]}function setLanguage(e){languagesetting=e,mp.storage.data.language=e,mp.storage.flush(),mp.events.callRemote("onPlayerLanguageChange",e)}mp.events.add("setLanguage",setLanguage);function loadLanguage(){var e=mp.game.invoke("E7A981467BC975BA",0),t=mp.storage.data.language;void 0!=t?languagesetting=t:2==e&&(languagesetting=""+Language.GERMAN)}loadLanguage();function getLanguage(){return languagesetting}var bombdata={changed:!1,gotbomb:!1,placestoplant:[],plantdefuseevent:!1,isplanting:!1,isdefusing:!1,plantdefusestarttick:0,plantedpos:null,draw:{backrect:null,progrect:null,text:null}};function updatePlantDefuseProgress(){var e=getTick()-bombdata.plantdefusestarttick;if(e<lobbysettings.bombplanttime){mp.game.controls.disableControlAction(0,24,!0);var t=e/lobbysettings.bombplanttime;bombdata.draw.progrect.setWidth(.078*t)}}function checkPlant(){for(var e=!1,t=mp.players.local.position,a=0;a<bombdata.placestoplant.length&&!e;a++){var n=bombdata.placestoplant[a];mp.game.gameplay.getDistanceBetweenCoords(t.x,t.y,t.z,n.x,n.y,n.z,!0)<=5&&(e=!0)}e&&(bombdata.plantdefusestarttick=getTick(),bombdata.isplanting=!0,bombdata.draw.backrect=new cRectangle(.46,.7,.08,.02,[0,0,0,187],Alignment.LEFT,!0),bombdata.draw.progrect=new cRectangle(.461,.701,.078,.018,[0,180,0,187],Alignment.LEFT,!0),bombdata.draw.text=new cText(getLang("round","planting"),.5,.7,0,[255,255,255,255],[1,.4],!0,Alignment.CENTER,!0),mp.events.callRemote("onPlayerStartPlanting"))}function checkDefuse(){var e=mp.players.local.position;mp.game.gameplay.getDistanceBetweenCoords(e.x,e.y,e.z,bombdata.plantedpos.x,bombdata.plantedpos.y,bombdata.plantedpos.z,!0)<=5&&(bombdata.plantdefusestarttick=getTick(),bombdata.isdefusing=!0,bombdata.draw.backrect=new cRectangle(.46,.7,.08,.02,[0,0,0,187],Alignment.LEFT,!0),bombdata.draw.progrect=new cRectangle(.461,.701,.078,.018,[180,0,0,187],Alignment.LEFT,!0),bombdata.draw.text=new cText(getLang("round","defusing"),.5,.7,0,[255,255,255,255],[1,.4],!0,Alignment.CENTER,!0),mp.events.callRemote("onPlayerStartDefusing"))}function removeBombDrawings(){null!=bombdata.draw.backrect&&(bombdata.draw.backrect.remove(),bombdata.draw.backrect=null,bombdata.draw.progrect.remove(),bombdata.draw.progrect=null,bombdata.draw.text.remove(),bombdata.draw.text=null)}function checkPlantDefuseStop(){bombdata.isplanting?(bombdata.isplanting=!1,mp.events.callRemote("onPlayerStopPlanting")):bombdata.isdefusing&&(bombdata.isdefusing=!1,mp.events.callRemote("onPlayerStopDefusing")),removeBombDrawings()}function checkPlantDefuseExtended(){return currentweapon==WeaponHash.OldUnarmed&&!mp.players.local.isDeadOrDying(!0)&&(mp.game.controls.disableControlAction(0,24,!0),!0)}function checkPlantDefuse(){if(bombdata.isdefusing||bombdata.isplanting)mp.game.controls.isDisabledControlJustReleased(0,24)?checkPlantDefuseStop():checkPlantDefuseExtended()?updatePlantDefuseProgress():checkPlantDefuseStop();else if(mp.game.controls.isControlJustPressed(0,24)&&checkPlantDefuseExtended())return bombdata.gotbomb?void checkPlant():void checkDefuse()}function localPlayerGotBomb(e){log("localPlayerGotBomb"),bombdata.changed=!0,bombdata.gotbomb=!0;for(var t=e.length;t--;)bombdata.placestoplant[t]=e[t];bombdata.plantdefuseevent=!0,mp.events.add("render",checkPlantDefuse)}function localPlayerPlantedBomb(){bombdata.gotbomb=!1,bombdata.plantdefuseevent=!1,bombdata.isplanting=!1,mp.events.remove("render",checkPlantDefuse),removeBombDrawings()}function bombPlanted(e,t){t&&(bombdata.changed=!0,bombdata.plantedpos=e,bombdata.plantdefuseevent=!0,mp.events.add("render",checkPlantDefuse)),setRoundTimeLeft(lobbysettings.bombdetonatetime)}function bombDetonated(){mp.game.cam.shakeGameplayCam("LARGE_EXPLOSION_SHAKE",1),new Timer(mp.game.cam.stopGameplayCamShaking,4e3,1)}function removeBombThings(){bombdata.changed&&(bombdata.plantdefuseevent&&mp.events.remove("checkPlantDefuse",checkPlantDefuse),removeBombDrawings(),bombdata={changed:!1,gotbomb:!1,placestoplant:[],plantdefuseevent:!1,isplanting:!1,isdefusing:!1,plantdefusestarttick:0,plantedpos:null,draw:{backrect:null,progrect:null,text:null}})}var cameradata={camera:mp.cameras.new("mapview"),moving:!1,timer:null};function loadMapMiddleForCamera(e){log("loadMapMiddleForCamera"),cameradata.camera.setCoord(e.x,e.y,e.z+110),cameradata.camera.pointAtCoord(e.x,e.y,e.z),cameradata.camera.setActive(!0),mp.game.cam.renderScriptCams(!0,!0,3e3,!0,!0)}function setCameraGoTowardsPlayer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;log("setCameraGoTowardsPlayer "+e);var t=gameplayCam.getCoord(),a=gameplayCam.getRot(2);cameradata.camera.setParams(t.x,t.y,t.z,a.x,a.y,a.z,gameplayCam.getFov(),-1==e?.9*lobbysettings.countdowntime:e,1,1,2)}function stopCountdownCamera(){log("stopCountdownCamera"),cameradata.camera.setActive(!1),mp.game.cam.renderScriptCams(!1,!1,0,!0,!0)}var lobbychoicedata={browser:null};mp.events.add("joinArena",function(e){mp.events.callRemote("joinLobby",1,e)}),mp.events.add("getLobbyChoiceLanguage",function(){log("getLobbyChoiceLanguage"),lobbychoicedata.browser.execute("getLobbyChoiceLanguage (`"+JSON.stringify(getLang("lobby_choice"))+"`)")}),mp.events.add("createLobby",function(){}),mp.events.add("onClientJoinMainMenu",function(){log("onClientJoinMainMenu"),lobbychoicedata.browser=mp.browsers.new("package://TDS-V/window/lobby/choice.html"),mp.events.add("browserDomReady",function(e){e==lobbychoicedata.browser&&lobbychoicedata.browser.execute("getLobbyChoiceLanguage (`"+JSON.stringify(getLang("lobby_choice"))+"`)")}),mp.gui.cursor.visible=!0,nothidecursor++});function destroyLobbyChoiceBrowser(){lobbychoicedata.browser.destroy(),0==--nothidecursor&&(mp.gui.cursor.visible=!1)}mp.events.add("onClientPlayerJoinLobby",function(){destroyLobbyChoiceBrowser()}),mp.events.add("onClientPlayerJoinRoundlessLobby",function(){log("onClientPlayerJoinRoundlessLobby"),destroyLobbyChoiceBrowser()});var countdowndata={sounds:["go","1","2","3"],text:null,timer:null};function countdownFunc(e){log("countdownFunc"),--e>0&&(countdowndata.text.setText(e+""),countdowndata.text.blendTextScale(6,1e3),countdowndata.timer=new Timer(countdownFunc,1e3,1,e),null!=countdowndata.sounds[e]&&playSound(countdowndata.sounds[e]))}function startCountdown(){log("startCountdown"),countdowndata.text=new cText(Math.floor(lobbysettings.countdowntime/1e3)+"",.5,.2,0,[255,255,255,255],[2,2],!0,Alignment.CENTER,!0),countdowndata.timer=new Timer(countdownFunc,lobbysettings.countdowntime%1e3,1,Math.floor(lobbysettings.countdowntime/1e3)+1)}function startCountdownAfterwards(e){log("startCountdownAfterwards"),countdowndata.text=new cText(e.toString()+"",.5,.2,0,[255,255,255,255],[2,2],!0,Alignment.CENTER,!0),countdownFunc(e+1)}function endCountdown(){log("endCountdown"),null==countdowndata.text?countdowndata.text=new cText("GO",.5,.2,0,[255,255,255,255],[2,2],!0,Alignment.CENTER,!0):countdowndata.text.setText("GO"),null!=countdowndata.timer&&countdowndata.timer.kill(),playSound(countdowndata.sounds[0]),countdowndata.timer=new Timer(stopCountdown,2e3,1)}function stopCountdown(){log("stopCountdown"),null!=countdowndata.text&&(countdowndata.text.remove(),countdowndata.text=null),null!=countdowndata.timer&&(countdowndata.timer.kill(),countdowndata.timer=null)}mp.events.add("onClientPlayerJoinLobby",function(e,t,a,n,o,i,s,r,l,d,m){log("onClientPlayerJoinLobby"),lobbysettings.id=e,rounddata.isspectator=1==t,setMapInfo(a),addTeamInfos(n=JSON.parse(n),o=JSON.parse(o)),lobbysettings.countdowntime=i,roundinfo.roundtime=s,lobbysettings.bombdetonatetime=r,lobbysettings.bombplanttime=l,lobbysettings.bombdefusetime=d,lobbysettings.roundendtime=m}),mp.events.add("onClientPlayerLeaveLobby",function(e){log("onClientPlayerLeaveLobby");var t=mp.players.at(e);mp.players.local==t&&(toggleFightMode(!1),removeBombThings(),removeRoundThings(!0),stopCountdownCamera(),removeRoundInfo())}),mp.events.add("onClientJoinMainMenu",function(){mp.game.cam.doScreenFadeIn(100)});var maplimitdata={limit:[],outsidecounter:11,checktimer:null,minX:0,maxX:0,minY:0,maxY:0,outsidetext:null};function pointIsInPoly(e){if(e.x<maplimitdata.minX||e.x>maplimitdata.maxX||e.y<maplimitdata.minY||e.y>maplimitdata.maxY)return!1;for(var t=!1,a=maplimitdata.limit,n=0,o=a.length-1;n<a.length;o=n++){var i=a[n].x,s=a[n].y,r=a[o].x,l=a[o].y,d;s>e.y!=l>e.y&&e.x<(r-i)*(e.y-s)/(l-s)+i&&(t=!t)}return t}function checkMapLimit(){if(null!=maplimitdata.limit){var e;pointIsInPoly(mp.players.local.position)?resetMapLimitCheck():(maplimitdata.outsidecounter--,10==maplimitdata.outsidecounter&&null==maplimitdata.outsidetext?maplimitdata.outsidetext=new cText(getLang("round","outside_map_limit").replace("{1}",maplimitdata.outsidecounter),.5,.5,0,[255,255,255,255],[1.2,1.2],!0,Alignment.CENTER,!0):maplimitdata.outsidecounter>0?maplimitdata.outsidetext.setText(getLang("round","outside_map_limit").replace("{1}",maplimitdata.outsidecounter)):0==maplimitdata.outsidecounter&&(mp.events.callRemote("onPlayerWasTooLongOutsideMap"),maplimitdata.checktimer.kill(),maplimitdata.checktimer=null,maplimitdata.outsidetext.remove(),maplimitdata.outsidetext=null))}else resetMapLimitCheck()}function loadMapLimitData(e){maplimitdata.limit=[];for(var t=0;t<e.length;t++)maplimitdata.limit[t]={x:e[t].Item1,y:e[t].Item2};if(maplimitdata.outsidecounter=11,e.length>0){for(var a=maplimitdata.limit[0].x,n=maplimitdata.limit[0].x,o=maplimitdata.limit[0].y,i=maplimitdata.limit[0].y,s=1;s<e.length;s++){var r=maplimitdata.limit[s];a=Math.min(r.x,a),n=Math.max(r.x,n),o=Math.min(r.y,o),i=Math.max(r.y,i)}maplimitdata.minX=a,maplimitdata.maxX=n,maplimitdata.minY=o,maplimitdata.maxY=i}}function resetMapLimitCheck(){null!=maplimitdata.outsidetext&&(maplimitdata.outsidetext.remove(),maplimitdata.outsidetext=null),maplimitdata.outsidecounter=11}function startMapLimit(){null!=maplimitdata.checktimer&&maplimitdata.checktimer.kill(),0 in maplimitdata.limit&&(maplimitdata.checktimer=new Timer(checkMapLimit,1e3,-1))}function stopMapLimitCheck(){null!=maplimitdata.checktimer&&(maplimitdata.checktimer.kill(),maplimitdata.checktimer=null),maplimitdata.outsidecounter=11,null!=maplimitdata.outsidetext&&(maplimitdata.outsidetext.remove(),maplimitdata.outsidetext=null)}function emptyMapLimit(){maplimitdata.limit=[]}var mapvotingdata={menu:null,lastlobbyID:-1,lastmapdatas:"",openwithlastdata:!1,menuloaded:!1};function openMapVotingMenu(){++nothidecursor,mp.gui.cursor.visible=!0,mapvotingdata.menuloaded=!1,mapvotingdata.menu=mp.browsers.new("package://TDS-V/window/mapmanager/mapmanager.html"),lobbysettings.id!=mapvotingdata.lastlobbyID?(mapvotingdata.openwithlastdata=!1,mp.events.callRemote("onMapMenuOpen")):mapvotingdata.openwithlastdata=!0}function closeMapVotingMenu(){mapvotingdata.menu.destroy(),mapvotingdata.menu=null,--nothidecursor<=0&&(mp.gui.cursor.visible=!1)}mp.events.add("closeMapVotingMenu",closeMapVotingMenu),mp.keys.bind(Keys.M,!1,function(){null==mapvotingdata.menu?openMapVotingMenu():closeMapVotingMenu()}),mp.events.add("onClientMapMenuOpen",function(e){mapvotingdata.lastmapdatas=e,mapvotingdata.menuloaded?mapvotingdata.menu.execute("openMapMenu ( '"+getLanguage()+"', '"+e+"');"):mapvotingdata.openwithlastdata=!0}),mp.events.add("browserDomReady",function(e){e==mapvotingdata.menu&&(mapvotingdata.menuloaded=!0,mapvotingdata.openwithlastdata&&mapvotingdata.menu.execute("openMapMenu ( '"+getLanguage()+"', '"+mapvotingdata.lastmapdatas+"');"))}),mp.events.add("onMapMenuVote",function(e){mp.events.callRemote("onMapVotingRequest",e)});var rounddata={mapinfo:null,isspectator:!0,infight:!1};function setMapInfo(e){null==rounddata.mapinfo?rounddata.mapinfo=new cText(e,.5,.95,0,[255,255,255,255],[.5,.5],!0,Alignment.CENTER,!0):rounddata.mapinfo.setText(e)}mp.events.add("render",function(){rounddata.infight});function removeMapInfo(){log("removeMapInfo"),null!=rounddata.mapinfo&&(rounddata.mapinfo.remove(),rounddata.mapinfo=null)}function removeRoundThings(e){log("removeRoundThings"),stopSpectate(),stopCountdown(),e&&removeMapInfo()}function toggleFightMode(e){log("toggleFightMode "+e),e?rounddata.infight=!0:(rounddata.infight=!1,stopMapLimitCheck())}mp.events.add("onClientMapChange",function(e,t,a,n,o){log("onClientMapChange"),setMapInfo(e),mp.game.cam.doScreenFadeIn(lobbysettings.roundendtime/2),(t=JSON.parse(t)).length>0&&loadMapLimitData(t),loadMapMiddleForCamera(new mp.Vector3(a,n,o)),toggleFightControls(!1)}),mp.events.add("onClientCountdownStart",function(e){log("onClientCountdownStart"),null!=cameradata.timer&&cameradata.timer.kill(),null==e?(startCountdown(),cameradata.timer=new Timer(setCameraGoTowardsPlayer,.1*lobbysettings.countdowntime,1)):(startCountdownAfterwards(Math.ceil((lobbysettings.countdowntime-e)/1e3)),e>.1*lobbysettings.countdowntime?setCameraGoTowardsPlayer(lobbysettings.countdowntime-e):cameradata.timer=new Timer(setCameraGoTowardsPlayer,.1*lobbysettings.countdowntime-e,1)),rounddata.isspectator&&startSpectate(),toggleFightControls(!1)}),mp.events.add("onClientRoundStart",function(e,t){log("onClientRoundStart"),mp.game.cam.doScreenFadeIn(50),stopCountdownCamera(),endCountdown(),rounddata.isspectator=1==e,rounddata.isspectator||(startMapLimit(),toggleFightMode(!0)),roundStartedRoundInfo(t),toggleFightControls(!0),mp.game.ui.displayHud(!0)}),mp.events.add("onClientRoundEnd",function(){log("onClientRoundEnd"),mp.game.cam.doScreenFadeOut(lobbysettings.roundendtime/2),toggleFightMode(!1),removeBombThings(),emptyMapLimit(),removeRoundThings(!1),stopCountdown(),stopCountdownCamera(),removeRoundInfo(),toggleFightControls(!1)}),mp.events.add("onClientPlayerSpectateMode",function(){log("onClientPlayerSpectateMode"),rounddata.isspectator=!0,startSpectate()}),mp.events.add("onClientPlayerDeath",function(e,t,a){log("onClientPlayerDeath");var n=mp.players.at(e);mp.players.local==n&&(toggleFightMode(!1),removeBombThings()),playerDeathRoundInfo(t,a)}),mp.events.add("PlayerQuit",function(e,t,a){log("PlayerQuit")}),mp.events.add("onClientPlayerGotBomb",function(e){localPlayerGotBomb(e)}),mp.events.add("onClientPlayerPlantedBomb",function(){localPlayerPlantedBomb()}),mp.events.add("onClientBombPlanted",function(e,t){bombPlanted(e,t)}),mp.events.add("onClientBombDetonated",function(){bombDetonated()}),mp.events.add("onClientPlayerTeamChange",function(e,t){setVoiceChatRoom(t)});var roundinfo={amountinteams:[],aliveinteams:[],roundtime:0,starttick:0,teamnames:[],teamcolors:[],drawclasses:{text:{time:null,teams:[]},rect:{time:null,teams:[]}},drawdata:{time:{text:{ypos:.005,scale:[.5,.5],color:[255,255,255,255]},rectangle:{xpos:.47,ypos:0,width:.06,height:.05,color:[20,20,20,180]}},team:{text:{ypos:-.002,scale:[.41,.41],color:[255,255,255,255]},rectangle:{ypos:0,width:.13,height:.06,a:180}},kills:{showtick:15e3,fadeaftertick:11e3,xpos:.99,ypos:.45,scale:[.3,.3],height:.04}}};function refreshRoundInfo(){var e=getTick(),t=Math.ceil((roundinfo.roundtime-(e-roundinfo.starttick))/1e3),a=Math.floor(t/60),n=t%60;roundinfo.drawclasses.text.time.setText(a+":"+(n>=10?n:"0"+n))}function setRoundTimeLeft(e){roundinfo.starttick=getTick()-(roundinfo.roundtime-e)}function removeRoundInfo(){if(roundinfo.amountinteams=[],roundinfo.aliveinteams=[],mp.events.remove("render",refreshRoundInfo),null!=roundinfo.drawclasses.rect.time){roundinfo.drawclasses.rect.time.remove(),roundinfo.drawclasses.text.time.remove();for(var e=0;e<roundinfo.drawclasses.text.teams.length;++e)roundinfo.drawclasses.text.teams[e].remove(),roundinfo.drawclasses.rect.teams[e].remove();roundinfo.drawclasses.text.time=null,roundinfo.drawclasses.rect.time=null,roundinfo.drawclasses.text.teams=[],roundinfo.drawclasses.rect.teams=[]}}function roundStartedRoundInfo(e){roundinfo.starttick=getTick(),null!=e&&(roundinfo.starttick-=e);var t=roundinfo.drawdata.time.text,a=roundinfo.drawdata.time.rectangle;roundinfo.drawclasses.rect.time=new cRectangle(a.xpos,a.ypos,a.width,a.height,a.color),roundinfo.drawclasses.text.time=new cText("0:00",a.xpos+a.width/2,t.ypos,0,t.color,t.scale,!0,Alignment.CENTER,!0);for(var n=roundinfo.drawdata.team.text,o=roundinfo.drawdata.team.rectangle,i=Math.ceil(roundinfo.teamnames.length/2),s=0;s<i;s++){var r=a.xpos-o.width*(s+1);roundinfo.drawclasses.rect.teams[s]=new cRectangle(r,o.ypos,o.width,o.height,[roundinfo.teamcolors[0+3*s],roundinfo.teamcolors[1+3*s],roundinfo.teamcolors[2+3*s],o.a]),roundinfo.drawclasses.text.teams[s]=new cText(roundinfo.teamnames[s]+"\n"+roundinfo.aliveinteams[s]+"/"+roundinfo.amountinteams[s],r+o.width/2,n.ypos,0,n.color,n.scale,!0,Alignment.CENTER,!0)}for(var l=0;l<roundinfo.teamnames.length-i;l++){var d=a.xpos+a.width+o.width*l,m=i+l;roundinfo.drawclasses.rect.teams[m]=new cRectangle(d,o.ypos,o.width,o.height,[roundinfo.teamcolors[0+3*m],roundinfo.teamcolors[1+3*m],roundinfo.teamcolors[2+3*m],o.a]),roundinfo.drawclasses.text.teams[m]=new cText(roundinfo.teamnames[m]+"\n"+roundinfo.aliveinteams[m]+"/"+roundinfo.amountinteams[m],d+o.width/2,n.ypos,0,n.color,n.scale,!0,Alignment.CENTER,!0)}mp.events.add("render",refreshRoundInfo)}function addTeamInfos(e,t){for(var a=1;a<e.length;a++)roundinfo.teamnames[a-1]=e[a];for(var n=3;n<t.length;n++)roundinfo.teamcolors[n-3]=t[n]}function refreshRoundInfoTeamData(){for(var e=0;e<roundinfo.drawclasses.text.teams.length;++e)roundinfo.drawclasses.text.teams[e].setText(roundinfo.teamnames[e]+"\n"+roundinfo.aliveinteams[e]+"/"+roundinfo.amountinteams[e])}function playerDeathRoundInfo(e,t){roundinfo.aliveinteams[e-1]--,roundinfo.drawclasses.text.teams[e-1].setText(roundinfo.teamnames[e-1]+"\n"+roundinfo.aliveinteams[e-1]+"/"+roundinfo.amountinteams[e-1]),addKillMessage(t)}mp.events.add("onClientPlayerAmountInFightSync",function(e,t,a){log("onClientPlayerAmountInFightSync"),roundinfo.amountinteams=[],roundinfo.aliveinteams=[],e=JSON.parse(e),1==t&&(a=JSON.parse(a));for(var n=0;n<e.length;n++)roundinfo.amountinteams[n]=Number.parseInt(e[n]),roundinfo.aliveinteams[n]=0==t?Number.parseInt(e[n]):Number.parseInt(a[n]);refreshRoundInfoTeamData()});var lobbysettings={id:-1,countdowntime:0,bombdetonatetime:0,bombplanttime:0,bombdefusetime:0,roundendtime:0},spectatedata={binded:!1};function pressSpectateKeyLeft(){mp.events.callRemote("spectateNext",!1)}function pressSpectateKeyRight(){mp.events.callRemote("spectateNext",!0)}function startSpectate(){spectatedata.binded||(mp.keys.bind(Keys.LeftArrow,!1,pressSpectateKeyLeft),mp.keys.bind(Keys.A,!1,pressSpectateKeyLeft),mp.keys.bind(Keys.RightArrow,!1,pressSpectateKeyRight),mp.keys.bind(Keys.D,!1,pressSpectateKeyRight),spectatedata.binded=!0)}function stopSpectate(){spectatedata.binded&&(mp.keys.unbind(Keys.LeftArrow,pressSpectateKeyLeft),mp.keys.unbind(Keys.A,pressSpectateKeyLeft),mp.keys.unbind(Keys.RightArrow,pressSpectateKeyRight),mp.keys.unbind(Keys.D,pressSpectateKeyRight),spectatedata.binded=!1)}var loginpanel={loginbrowser:null,name:null,isregistered:null};mp.events.add("loginFunc",function(e){mp.events.callRemote("onPlayerTryLogin",e)}),mp.events.add("registerFunc",function(e,t){mp.events.callRemote("onPlayerTryRegister",e,t)}),mp.events.add("getRegisterLoginLanguage",function(){loginpanel.loginbrowser.execute("loadLanguage ( `"+JSON.stringify(getLang("loginregister"))+"` );")}),mp.events.add("startRegisterLogin",function(e,t){log("startRegisterLogin registerlogin"),loginpanel.name=e,loginpanel.isregistered=1==t,loginpanel.loginbrowser=mp.browsers.new("package://TDS-V/window/registerlogin/registerlogin.html"),mp.events.add("browserDomReady",function(e){e==loginpanel.loginbrowser&&e.execute("getLoginPanelData ( `"+loginpanel.name+"`, `"+loginpanel.isregistered+"`, `"+JSON.stringify(getLang("loginregister"))+"` );")}),mp.gui.chat.show(!1),mp.game.ui.displayHud(!1),mp.gui.cursor.visible=!0,nothidecursor++}),mp.events.add("registerLoginSuccessful",function(){log("registerLoginSuccessful registerlogin"),loginpanel.loginbrowser.destroy(),loginpanel.loginbrowser=null,mp.gui.chat.show(!0),mp.game.ui.displayHud(!0),nothidecursor--});