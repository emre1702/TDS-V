"use strict";var e=$("#money"),n=$("#bloodscreen"),t=$("#kill_messages_box"),a="ENGLISH",o=$("#orders");function setMoney(n){e.text("$"+n)}function playSound(e){$("#audio_"+e).trigger("play").volume=.05}function showBloodscreen(){n.stop().show(0).hide(2500)}function i(e){var n='<span style="color: white;">',t=e;return-1!==e.indexOf("~")&&(t=t.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),n+t+"</span>"}function s(e){e.remove()}function addKillMessage(e){var n=$("<text>"+i(e)+"<br></text>");t.append(n),n.delay(11e3).fadeOut(4e3,n.remove)}function loadOrderNames(e){o.empty();for(var n=JSON.parse(e),t=0;t<n.length&&t<9;++t)o.append($("<div>"+(t+1)+". "+n[t]+"</div>"))}var r=$("#mapmenu"),c=$("#tabs-1"),l=$("#tabs-2"),d=$("#tabs-3"),p=$(O),u=$("#map_info"),h=$("#choose_map_button"),v=$("#add_map_to_favourites"),f=$("#mapvoting"),g=void 0,m="",b=!1,y=[],_=[],w="",x=!1,C=!1,k=!1,O="#tabs-4",D=!0;$("#tabs").tabs({collapsible:!0,heightStyle:"fill"}),$(".tab_list").each(function(e,n){$(this).selectable({selected:function e(n,t){$(".ui-selected").removeClass("ui-selected"),$(t.selected).addClass("ui-selected");var o=t.selected.innerHTML;R(o);for(var i=0;i<g.length;++i)if(o===g[i].Name)return m=o,C||(h.show(0),u.show(0),v.show(0),C=!0),void u.html(g[i].Description[a])},autoRefresh:!1})}),h.click(function(e){e.preventDefault(),x||""!==m&&(w=m,mp.trigger("onMapMenuVote",w),J())}),v.click(function(e){if(e.preventDefault(),""!==m){var n=_.indexOf(m);-1===n?(_.push(m),v.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),mp.trigger("onClientToggleMapFavourite",m,!0),d.append($("<div>"+m+"</div>"))):(_.splice(n,1),v.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),mp.trigger("onClientToggleMapFavourite",m,!1),d.children("div:contains('"+m+"')").remove()),d.selectable("refresh")}});function openMapMenu(e,n){r.show(1e3),b=!0,a=e,m="",w="",c.empty(),l.empty(),d.empty(),p.empty(),g=JSON.parse(n);for(var t=0;t<g.length;++t){var o=$("<div>"+g[t].Name+"</div>");0===g[t].Type?c.append(o):l.append(o),-1!==_.indexOf(g[t].Name)&&d.append(o.clone())}for(var i=0;i<y.length;++i)p.append($("<div>"+y[i].name+"</div>"));c.selectable("refresh"),l.selectable("refresh"),d.selectable("refresh"),p.selectable("refresh")}function closeMapMenu(){b=!1,r.hide(500),C&&(h.hide(500),u.hide(500),v.hide(500),C=!1)}function S(e,n){return e.votes>n.votes?-1:1}function M(){y.sort(S)}function N(e){y.push({name:e,votes:1});var n=$("<div>"+y.length+". "+e+" (1)</div>");f.append(n),b&&(p.append($("<div>"+e+"</div>")),p.selectable("refresh")),w===e&&(n.addClass("mapvoting_selected"),w="")}function T(){for(var e=f.children(),n=0;n<e.length;++n)n in y?e.eq(n).text(n+1+". "+mapname+" ("+votes[n].votings+")"):y.splice(n)}function I(e){for(var n=0;n<y.length;++n)if(y[n].name===e)return--y[n].votes<=0&&(y.splice(n,1),f.children().eq(n).remove(),b&&$(O+" div:contains("+e+")")),void T()}function addVoteToMapVoting(e,n){w===e&&$(".mapvoting_selected").removeClass("mapvoting_selected"),void 0!==n&&I(n);for(var t=!1,a=0;a<y.length&&!t;++a)if(y[a].name===e){++y[a].votes;var o=f.children().eq(a);o.text(a+1+". "+e+"("+y[a].votes+")"),w===e&&(o.addClass("mapvoting_selected"),w=""),t=!0}t||N(e),M()}function loadMapVotings(e){var n=JSON.parse(mapsvotesjson);y=[];for(var t in n)y.push({name:t,votes:n[t]});M()}function clearMapVotings(){y=[],f.empty(),b&&(p.empty(),p.selectable("refresh"))}function J(){x=!0,h.disabled=!0,setTimeout(function(){x=!1,h.disabled=!1},1500)}$("body").keydown(function(e){var n=e.which;if(D&&n>=97&&n<=105){if(x)return;e.preventDefault();var t=9-(105-n)-1;y.length>t&&(w=y[t].name,mp.trigger("onMapMenuVote",w),J())}});function R(e){-1!==_.indexOf(e)?k||(v.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),k=!0):k&&(v.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),k=!1)}function loadFavouriteMaps(e){_=JSON.parse(e)}function toggleCanVoteForMapWithNumpad(e){D=e,e?(o.hide(300),f.show(300)):(o.show(300),f.hide(300))}var q={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},A=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(e=null===e?E():e).finish().animate({scrollTop:e.prop("scrollHeight")},"slow")}function L(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!q.active&&e||e!==q.inputshowing&&(mp.invoke("focus",e),e?(q.maininput.fadeIn(),q.maininput.val(n),setTimeout(function(){q.maininput.focus()},100)):(q.maininput.hide(),q.maininput.val("")),q.inputshowing=e,mp.trigger("onChatInputToggle",e))}var chatAPI={};chatAPI.push=j,chatAPI.clear=function(){E().html("")},chatAPI.activate=function(e){L(e),q.active=e},chatAPI.show=function(e){e?(E().show(),$("#chat_choice").show()):(E().hide(),$("#chat_choice").hide()),!e&&q.inputshowing&&L(!1),q.active=e};function i(e,n){var t="";n&&(t='<span style="background-color: rgba(255,178,102,0.6);">'),t+='<span style="color: white;">';var a=e;if(-1!==e.indexOf("#")){for(var o=0;o<A.length;++o)a=a.replace(A[o][0],"</span><span style='color: "+A[o][1]+";'>");a=a.replace(/#n#/g,"<br>")}return n&&(a+="</span>"),t+a+"</span>"}function F(e){if(null===q.myname)return!1;var n=e.indexOf("@");if(-1===n)return!1;var t=e.indexOf(":",n+1);if(-1===t)return!1;var a;return e.substring(n+1,t)===q.myname}function V(e,n,t){n.append(e),++q.amountentries[t]>=q.maxentries&&(--q.amountentries[t],n.find("text:first").remove()),H(n)}function j(e){for(var n=F(e),t=0;t<q.chatends.length;++t)if(e.endsWith(q.chatends[t])){e=e.slice(0,-q.chatends[t].length);var a=E(t),o=i(e,n),s;return void V($("<text>"+o+"</text>"),a,t)}for(var r=i(e,n),c=0;c<q.bodies.length;++c){var l=E(c),d;V($("<text>"+r+"</text>"),l,c)}}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=-1===e?q.chosenchatbody:e;return q.bodies[n]}function loadUserName(e){q.myname=e,q.playernames.push(e)}function addNameForChat(e){q.playernames.push(username)}function removeNameForChat(e){var n=q.playernames.indexOf(e);-1!==n&&q.playernames.splice(n,1)}$(document).ready(function(){addAutocomplete(q.maininput,q.playernames,function(){return q.autocompleteon=!0,!1},function(){setTimeout(function(){q.autocompleteon=!1},500)}),$("body").keydown(function(e){if(84===e.which&&!q.inputshowing&&q.active)e.preventDefault(),L(!0);else if(e.which===q.globalsaykeycode&&!q.inputshowing&&q.active)e.preventDefault(),L(!0,"/globalsay ");else if(13===e.which&&q.inputshowing&&!q.autocompleteon){e.preventDefault();var n=q.maininput.val();n&&("/"===(n=n.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'))[0]?(n=n.substr(1)).length>0&&mp.invoke("command",n):mp.invoke("chatMessage",n+q.chatends[q.chosenchatbody])),L(!1)}}),q.chosentab=$("#chat_choice div[data-chatID=0]"),q.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){q.chosenchatbody!==$(this).attr("data-chatID")&&(q.chosentab.css("background","#A9A9A9"),q.bodies[q.chosenchatbody].hide(400),q.chosentab=$(this),q.chosentab.css("background","#04074e"),q.chosenchatbody=q.chosentab.attr("data-chatID"),q.bodies[q.chosenchatbody].show(400))}),mp.trigger("onChatLoad")});var G=$("#round_end_reason"),W=$("#round_end_reason_container"),Z={},z=void 0,B=new SimpleStarRating($("#map_rating_stars")[0],function(e){z in Z&&Z[z]===e||(Z[z]=e,mp.trigger("sendMapRanking",z,e),B.disable())});function showRoundEndReason(e,n){G.html(e),W.css("display","table"),z=n,n in Z?B.setCurrentRating(Z[n]):B.setCurrentRating(0),B.enable()}function hideRoundEndReason(){W.hide()}function loadMyMapRatings(e){Z=JSON.parse(e)}