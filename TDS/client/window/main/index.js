"use strict";var e=$("#money"),t=$("#bloodscreen"),n=$("#kill_messages_box"),a="ENGLISH",o=$("#orders"),i=$("#round_end_reason"),s=$("#round_end_reason_container");function setMoney(t){e.text("$"+t)}function playSound(e){$("#audio_"+e).trigger("play").volume=.05}function showBloodscreen(){t.stop().show(0).hide(2500)}function r(e){var t='<span style="color: white;">',n=e;return-1!==e.indexOf("~")&&(n=n.replace(/~r~/g,'</span><span style="color: rgb(222, 50, 50);">').replace(/~b~/g,'</span><span style="color: rgb(92, 180, 227);">').replace(/~g~/g,'</span><span style="color: rgb(113, 202, 113);">').replace(/~y~/g,'</span><span style="color: rgb(238, 198, 80);">').replace(/~o~/g,'</span><span style="color: rgb(253, 132, 85);">').replace(/~s~/g,'</span><span style="color: rgb(220, 220, 220);">').replace(/~w~/g,'</span><span style="color: white;">').replace(/~dr~/g,'</span><span style="color: rgb( 169, 25, 25 );">').replace(/~n~/g,"<br>")),t+n+"</span>"}function c(e){e.remove()}function addKillMessage(e){var t=$("<text>"+r(e)+"<br></text>");n.append(t),t.delay(11e3).fadeOut(4e3,t.remove)}function loadOrderNames(e){o.empty();for(var t=JSON.parse(e),n=0;n<t.length&&n<9;++n)o.append($("<div>"+(n+1)+". "+t[n]+"</div>"))}function showRoundEndReason(e){i.html(e),s.css("display","table")}function hideRoundEndReason(){s.hide()}var l=$("#mapmenu"),d=$("#tabs-1"),p=$("#tabs-2"),u=$("#tabs-3"),h=$(T),v=$("#map_info"),f=$("#choose_map_button"),m=$("#add_map_to_favourites"),g=$("#mapvoting"),b=void 0,y="",_=!1,w=[],x=[],C="",k=!1,O=!1,D=!1,T="#tabs-4",M=!0;$("#tabs").tabs({collapsible:!0,heightStyle:"fill"}),$(".tab_list").each(function(e,t){$(this).selectable({selected:function e(t,n){$(".ui-selected").removeClass("ui-selected"),$(n.selected).addClass("ui-selected");var o=n.selected.innerHTML;H(o);for(var i=0;i<b.length;++i)if(o===b[i].Name)return y=o,O||(f.show(0),v.show(0),m.show(0),O=!0),void v.html(b[i].Description[a])},autoRefresh:!1})}),f.click(function(e){e.preventDefault(),k||""!==y&&(C=y,mp.trigger("onMapMenuVote",C),J())}),m.click(function(e){if(e.preventDefault(),""!==y){var t=x.indexOf(y);-1===t?(x.push(y),m.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),mp.trigger("onClientToggleMapFavourite",y,!0),u.append($("<div>"+y+"</div>"))):(x.splice(t,1),m.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),mp.trigger("onClientToggleMapFavourite",y,!1),u.children("div:contains('"+y+"')").remove()),u.selectable("refresh")}});function openMapMenu(e,t){l.show(1e3),_=!0,a=e,y="",C="",d.empty(),p.empty(),u.empty(),h.empty(),b=JSON.parse(t);for(var n=0;n<b.length;++n){var o=$("<div>"+b[n].Name+"</div>");0===b[n].Type?d.append(o):p.append(o),-1!==x.indexOf(b[n].Name)&&u.append(o.clone())}for(var i=0;i<w.length;++i)h.append($("<div>"+w[i].name+"</div>"));d.selectable("refresh"),p.selectable("refresh"),u.selectable("refresh"),h.selectable("refresh")}function closeMapMenu(){_=!1,l.hide(500),O&&(f.hide(500),v.hide(500),m.hide(500),O=!1)}function N(e,t){return e.votes>t.votes?-1:1}function S(){w.sort(N)}function I(e){w.push({name:e,votes:1});var t=$("<div>"+w.length+". "+e+" (1)</div>");g.append(t),_&&(h.append($("<div>"+e+"</div>")),h.selectable("refresh")),C===e&&(t.addClass("mapvoting_selected"),C="")}function q(){for(var e=g.children(),t=0;t<e.length;++t)t in w?e.eq(t).text(t+1+". "+mapname+" ("+votes[t].votings+")"):w.splice(t)}function A(e){for(var t=0;t<w.length;++t)if(w[t].name===e)return--w[t].votes<=0&&(w.splice(t,1),g.children().eq(t).remove(),_&&$(T+" div:contains("+e+")")),void q()}function addVoteToMapVoting(e,t){C===e&&$(".mapvoting_selected").removeClass("mapvoting_selected"),void 0!==t&&A(t);for(var n=!1,a=0;a<w.length&&!n;++a)if(w[a].name===e){++w[a].votes;var o=g.children().eq(a);o.text(a+1+". "+e+"("+w[a].votes+")"),C===e&&(o.addClass("mapvoting_selected"),C=""),n=!0}n||I(e),S()}function loadMapVotings(e){var t=JSON.parse(mapsvotesjson);w=[];for(var n in t)w.push({name:n,votes:t[n]});S()}function clearMapVotings(){w=[],g.empty(),_&&(h.empty(),h.selectable("refresh"))}function J(){k=!0,f.disabled=!0,setTimeout(function(){k=!1,f.disabled=!1},1500)}$("body").keydown(function(e){var t=e.which;if(M&&t>=97&&t<=105){if(k)return;e.preventDefault();var n=9-(105-t)-1;w.length>n&&(C=w[n].name,mp.trigger("onMapMenuVote",C),J())}});function H(e){-1!==x.indexOf(e)?D||(m.removeClass("add_map_to_favourites_notselected").addClass("add_map_to_favourites_selected"),D=!0):D&&(m.removeClass("add_map_to_favourites_selected").addClass("add_map_to_favourites_notselected"),D=!1)}function loadFavouriteMaps(e){x=JSON.parse(e)}function toggleCanVoteForMapWithNumpad(e){M=e,e?(o.hide(300),g.show(300)):(o.show(300),g.hide(300))}var L={amountentries:[0,0],maxentries:40,active:!0,inputshowing:!1,maininput:$("#main-input"),bodies:[$("#normal-chat-body"),$("#dirty-chat-body")],chatends:["$normal$","$dirty$"],chosentab:null,chosenchatbody:0,myname:null,globalsaykeycode:"Z"===String.fromCharCode(90)?90:Y,playernames:[],autocompleteon:!1},F=[[/#r#/g,"rgb(222, 50, 50)"],[/#b#/g,"rgb(92, 180, 227)"],[/#g#/g,"rgb(113, 202, 113)"],[/#y#/g,"rgb(238, 198, 80)"],[/#p#/g,"rgb(131, 101, 224)"],[/#q#/g,"rgb(226, 79, 128)"],[/#o#/g,"rgb(253, 132, 85)"],[/#s#/g,"rgb(220, 220, 220)"],[/#w#/g,"white"],[/#dr#/g,"rgb(169, 25, 25)"]];function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(e=null===e?W():e).finish().animate({scrollTop:e.prop("scrollHeight")},"slow")}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!L.active&&e||e!==L.inputshowing&&(mp.invoke("focus",e),e?(L.maininput.fadeIn(),L.maininput.val(t),setTimeout(function(){L.maininput.focus()},100)):(L.maininput.hide(),L.maininput.val("")),L.inputshowing=e,mp.trigger("onChatInputToggle",e))}var chatAPI={};chatAPI.push=R,chatAPI.clear=function(){W().html("")},chatAPI.activate=function(e){j(e),L.active=e},chatAPI.show=function(e){e?(W().show(),$("#chat_choice").show()):(W().hide(),$("#chat_choice").hide()),!e&&L.inputshowing&&j(!1),L.active=e};function r(e,t){var n="";t&&(n='<span style="background-color: rgba(255,178,102,0.6);">'),n+='<span style="color: white;">';var a=e;if(-1!==e.indexOf("#")){for(var o=0;o<F.length;++o)a=a.replace(F[o][0],"</span><span style='color: "+F[o][1]+";'>");a=a.replace(/#n#/g,"<br>")}return t&&(a+="</span>"),n+a+"</span>"}function E(e){if(null===L.myname)return!1;var t=e.indexOf("@");if(-1===t)return!1;var n=e.indexOf(":",t+1);if(-1===n)return!1;var a;return e.substring(t+1,n)===L.myname}function G(e,t,n){t.append(e),++L.amountentries[n]>=L.maxentries&&(--L.amountentries[n],t.find("text:first").remove()),V(t)}function R(e){for(var t=E(e),n=0;n<L.chatends.length;++n)if(e.endsWith(L.chatends[n])){e=e.slice(0,-L.chatends[n].length);var a=W(n),o=r(e,t),i;return void G($("<text>"+o+"</text>"),a,n)}for(var s=r(e,t),c=0;c<L.bodies.length;++c){var l=W(c),d;G($("<text>"+s+"</text>"),l,c)}}function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=-1===e?L.chosenchatbody:e;return L.bodies[t]}function loadUserName(e){L.myname=e,L.playernames.push(e)}function addNameForChat(e){L.playernames.push(username)}function removeNameForChat(e){var t=L.playernames.indexOf(e);-1!==t&&L.playernames.splice(t,1)}$(document).ready(function(){addAutocomplete(L.maininput,L.playernames,function(){return L.autocompleteon=!0,!1},function(){setTimeout(function(){L.autocompleteon=!1},500)}),$("body").keydown(function(e){if(84===e.which&&!L.inputshowing&&L.active)e.preventDefault(),j(!0);else if(e.which===L.globalsaykeycode&&!L.inputshowing&&L.active)e.preventDefault(),j(!0,"/globalsay ");else if(13===e.which&&L.inputshowing&&!L.autocompleteon){e.preventDefault();var t=L.maininput.val();t&&("/"===t[0]?(t=t.substr(1)).length>0&&mp.invoke("command",t):mp.invoke("chatMessage",t+L.chatends[L.chosenchatbody])),j(!1)}}),L.chosentab=$("#chat_choice div[data-chatID=0]"),L.chosentab.css("background","#04074e"),$("#chat_choice div").click(function(){L.chosenchatbody!==$(this).attr("data-chatID")&&(L.chosentab.css("background","#A9A9A9"),L.bodies[L.chosenchatbody].hide(400),L.chosentab=$(this),L.chosentab.css("background","#04074e"),L.chosenchatbody=L.chosentab.attr("data-chatID"),L.bodies[L.chosenchatbody].show(400))}),mp.trigger("onChatLoad")});