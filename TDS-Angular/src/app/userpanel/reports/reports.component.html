<div id="main-report" *ngIf="inReport === undefined && !inCreate">
    <table id="main-report-table" class="window-field">
        <thead>
            <tr>
                <th (click)="sortID()" class="not-selectable">ID</th>
                <th (click)="sortTitle()" class="not-selectable">{{ language.title }}</th>
                <th (click)="sortState()" class="not-selectable">{{ language.state }}</th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let entry of rowDatas; let i = index;">
                <tr (click)="selectRow($event, i);" >
                    <td>{{ entry.ID }}</td>
                    <td>{{ entry.Title }}</td>
                    <td *ngIf="!entry.Open"><mat-icon>done</mat-icon></td>
                    <td *ngIf="entry.Open">-</td>
                </tr> 
            </ng-container>   
        </tbody>
    </table>
    <div id="main-buttons">
        <button id="main-create" mat-button *ngIf="selectedRowIndex === undefined" (click)="switchToCreation()">{{ language.create }}</button>
        <button id="main-view" mat-button *ngIf="selectedRowIndex !== undefined" (click)="switchToReport()">{{ language.view }}</button>
        <button id="main-open" mat-button *ngIf="selectedRowIndex !== undefined && rowDatas[selectedRowIndex].Open == false" (click)="toggleRowState()">{{ language.open }}</button>
        <button id="main-close" mat-button *ngIf="selectedRowIndex !== undefined && rowDatas[selectedRowIndex].Open == true" (click)="toggleRowState()">{{ language.close }}</button> 
        <button id="main-remove" mat-button *ngIf="selectedRowIndex !== undefined && myAdminlvl >= neededAdminlvls.removeReport" (click)="removeReport()">{{ language.remove }}</button>
    </div>
</div>

<div id="report-view" *ngIf="inReport !== undefined && !inCreate">
    <div class="chat-header clearfix">
      
      <div class="chat-about">
        <div class="chat-with">{{ rowDatas[inReport].Title }}</div>
        <div class="chat-num-messages">{{ rowDatas[inReport].Author }} ({{ rowDataTexts[rowDatas[inReport].ID].length }})</div>
      </div>
    </div> <!-- end chat-header -->
    <div class="chat-history">
        <ul> 
            <li>
                <div class="message-data">
                    <span class="message-data-name" >{{ rowDataTexts[rowDatas[inReport].ID][0].Author }}</span> 
                    <span class="message-data-time" >{{ rowDataTexts[rowDatas[inReport].ID][0].Date }}</span> &nbsp; &nbsp;         
                </div>
                <div class="message my-message">{{ rowDataTexts[rowDatas[inReport].ID][0].Text }}</div>
            </li>
            <div *ngFor="let textentry of rowDataTexts[rowDatas[inReport].ID]; let i = index">
                <li class="clearfix" *ngIf="i != 0 && textentry.Author !== rowDataTexts[rowDatas[inReport].ID][0].Author" >
                    <div class="message-data align-right">
                        <span class="message-data-time" >{{ rowDataTexts[rowDatas[inReport].ID][i].Date }}</span> &nbsp; &nbsp;
                        <span class="message-data-name" >{{ rowDataTexts[rowDatas[inReport].ID][i].Author }}</span>            
                    </div>
                    <div class="message other-message float-right">{{ rowDataTexts[rowDatas[inReport].ID][i].Text }}</div>
                </li>
                <li *ngIf="i != 0 && textentry.Author === rowDataTexts[rowDatas[inReport].ID][0].Author">
                    <div class="message-data">
                        <span class="message-data-name">{{ rowDataTexts[rowDatas[inReport].ID][i].Author }}</span>
                        <span class="message-data-time">{{ rowDataTexts[rowDatas[inReport].ID][i].Date }}</span>
                    </div>
                    <div class="message my-message">{{ rowDataTexts[rowDatas[inReport].ID][i].Text }}</div>
                </li>
            </div>
        </ul>
    </div>
    <mat-form-field id="report-view-interaction" [color]="formOptions.value.color">
        <textarea matInput #reportTextArea required rows="3" id="report-view-text-textarea" [placeholder]="language.answer"></textarea>
        <mat-hint align="end">{{reportTextArea.value?.length || 0}}/250</mat-hint>
        <button id="report-view-text-send" mat-button (click)="sendReportAnswer()">{{ language.send }}</button>
    </mat-form-field>
</div>

<div *ngIf="inCreate">
    <div id="report_creation_left_side">
        <mat-form-field [color]="formOptions.value.color">
            <input matInput #titleInput required placeholder="Title">
            <mat-hint align="end">{{titleInput.value?.length || 0}}/50</mat-hint>
        </mat-form-field>
        <mat-form-field id="create_textarea" [color]="formOptions.value.color">
            <textarea matInput #textArea required rows="9" placeholder="Text"></textarea>
            <mat-hint align="end">{{textArea.value?.length || 0}}/250</mat-hint>
        </mat-form-field>
    </div>
    <div id="report_creation_right_side">
        <table id="for_teammember" class="window-field">
            <thead>
                <tr>
                    <th>{{ language.for_teammember }}</th>
                </tr>
            </thead>
            <tbody>
                <tr (click)="setReportFor(1)">
                    <td *ngIf="forMinAdminlvl < 1" >{{ language.owner }}</td>
                    <td id="selected_owner" *ngIf="forMinAdminlvl >= 1">{{ language.owner }}</td>
                </tr>
                <tr (click)="setReportFor(2)">
                    <td *ngIf="forMinAdminlvl < 2">{{ language.projectmanager }}</td>
                    <td id="selected_projectmanager" *ngIf="forMinAdminlvl >= 2">{{ language.projectmanager }}</td>
                </tr>  
                <tr (click)="setReportFor(3)">
                    <td *ngIf="forMinAdminlvl < 3">{{ language.administrator }}</td>
                    <td id="selected_administrator" *ngIf="forMinAdminlvl >= 3">{{ language.administrator }}</td>
                </tr>  
                <tr (click)="setReportFor(4)">
                    <td *ngIf="forMinAdminlvl < 4">{{ language.supporter }}</td>
                    <td id="selected_supporter" *ngIf="forMinAdminlvl >= 4">{{ language.supporter }}</td>
                </tr>
            </tbody>
        </table>
        <button id="creation-send" mat-button (click)="createReport()">Send</button>    
    </div>
</div>
